"use strict";(self.webpackChunkavalon_ng=self.webpackChunkavalon_ng||[]).push([[3129],{3948:(S,p,i)=>{i.d(p,{h:()=>h});var n=i(8274),l=i(6895),o=i(6679);const d=function(f){return{background:f}};function m(f,u){if(1&f&&(n.ynx(0),n.TgZ(1,"p-tag",1)(2,"div",2),n._UZ(3,"i",3),n.TgZ(4,"span",4),n._uU(5),n.qZA()()(),n.BQk()),2&f){const c=u.ngIf;n.xp6(1),n.Akn(n.VKq(6,d,c.color)),n.Q6J("rounded",!0),n.xp6(2),n.Tol(c.icon),n.xp6(2),n.Oqu(c.name)}}let h=(()=>{class f{constructor(){}ngOnInit(){}trackByFn(c,s){return s.id||c}}return f.\u0275fac=function(c){return new(c||f)},f.\u0275cmp=n.Xpm({type:f,selectors:[["app-task-status"]],inputs:{taskStatus:"taskStatus"},decls:1,vars:1,consts:[[4,"ngIf"],["styleClass","px-3",3,"rounded"],[1,"flex","align-items-center","gap-1"],[2,"font-size","11px"],[1,"font-semibold",2,"font-size","11px"]],template:function(c,s){1&c&&n.YNc(0,m,6,8,"ng-container",0),2&c&&n.Q6J("ngIf",s.taskStatus)},dependencies:[l.O5,o.V],encapsulation:2}),f})()},3446:(S,p,i)=>{i.d(p,{O:()=>f});var n=i(8274),l=i(433),o=i(6895),d=i(2156),m=i(585);function h(u,c){1&u&&(n.ynx(0),n.TgZ(1,"label",3)(2,"span"),n._uU(3,"\u0e9b\u0eb0\u0e88\u0eb3\u0e9b\u0eb5:"),n.qZA()(),n.BQk())}let f=(()=>{class u{constructor(s,a){this.parentForm=s,this.cdr=a,this.showLabel=!0,this.yearSelected=new n.vpe,this.onChange=()=>{},this.onTouched=()=>{}}get control(){return this.formGroup.get("docYear")}ngOnInit(){this.formGroup=this.parentForm.control;const s=(new Date).getFullYear(),a=new Date(s,0,1);this.formGroup.patchValue({docYear:a}),this.cdr.detectChanges()}writeValue(s){s&&(this.selectedValue=s)}registerOnChange(s){this.onChange=s}registerOnTouched(s){this.onTouched=s}onSelectYear(s){this.writeValue(s),this.onChange(s),this.yearSelected.emit(s)}}return u.\u0275fac=function(s){return new(s||u)(n.Y36(l.sg),n.Y36(n.sBO))},u.\u0275cmp=n.Xpm({type:u,selectors:[["app-year-picker"]],inputs:{showLabel:"showLabel"},outputs:{yearSelected:"yearSelected"},features:[n._Bn([{provide:l.JU,useExisting:(0,n.Gpc)(()=>u),multi:!0}])],decls:3,vars:3,consts:[[3,"formGroup"],[4,"ngIf"],["view","year","dateFormat","yy","inputId","yearpicker","placeholder","\u0ec0\u0ea5\u0eb7\u0ead\u0e81\u0e9b\u0eb5","styleClass","mr-2","formControlName","docYear",3,"readonlyInput","onSelect"],["for","yearpicker",1,"font-semibold","white-space-nowrap","mr-1"]],template:function(s,a){1&s&&(n.TgZ(0,"form",0),n.YNc(1,h,4,0,"ng-container",1),n.TgZ(2,"p-calendar",2),n.NdJ("onSelect",function(e){return a.onSelectYear(e)}),n.qZA()()),2&s&&(n.Q6J("formGroup",a.formGroup),n.xp6(1),n.Q6J("ngIf",a.showLabel),n.xp6(1),n.Q6J("readonlyInput",!0))},dependencies:[o.O5,l._Y,l.JJ,l.JL,l.sg,l.u,d.bc,d.VP,d.YE,m.f],encapsulation:2}),u})()},6749:(S,p,i)=>{i.d(p,{g:()=>m});var n=i(6895),l=i(4466),o=i(585),d=i(8274);let m=(()=>{class h{}return h.\u0275fac=function(u){return new(u||h)},h.\u0275mod=d.oAB({type:h}),h.\u0275inj=d.cJS({imports:[n.ez,l.m,o._8]}),h})()},7248:(S,p,i)=>{i.d(p,{U:()=>o});var n=i(655),l=i(2156);class o{}(0,n.gn)([(0,l.C1)()],o.prototype,"docYear",void 0)},6522:(S,p,i)=>{i.d(p,{_:()=>n});class n{static getWaiting(o,d=!0){let m=["main.id","main.docYear","main.taskId","main.taskSubject","main.selfTimeScore","main.selfQuantityScore","main.selfQualityScore","main.selfSatisfiedScore","main.selfCode","main.createdAt","main.isLock","staff.staffCode","staff.firstName","staff.lastName","status.icon","status.name","status.color"];return d&&m.push("main.taskWfId"),{query:{fields:m,joins:["staff","status"],filters:o,getType:"MANY"}}}static getMany(o){return{query:{fields:["main.docYear","main.id","main.taskId","main.taskSubject","main.selfTimeScore","main.selfQuantityScore","main.selfQualityScore","main.selfSatisfiedScore","main.headTimeScore","main.headQuantityScore","main.headQualityScore","main.headSatisfiedScore","main.selfCode","main.createdAt","main.headActionAt","main.isLock","staff.staffCode","staff.firstName","staff.lastName","status.icon","status.name","status.color"],joins:["staff","status"],filters:o,getType:"MANY"}}}static getDetail(o,d=!0){const m=["main.docYear","main.id","main.taskId","main.taskSubject","main.reportDetail","main.scheduledStart","main.scheduledEnd","main.selfTimeScore","main.selfQuantityScore","main.selfQualityScore","main.selfSatisfiedScore","main.selfCode","main.headTimeScore","main.headQuantityScore","main.headQualityScore","main.headSatisfiedScore","main.createdAt","main.headActionAt","main.comment","task.indicatorTime","task.indicatorQuantity","iq.id","iq.subject","is.id","is.subject","priority.name","priority.color","priority.score","staff.staffCode","staff.firstName","staff.lastName","head.staffCode","head.firstName","head.lastName","status.icon","status.name","status.color","attached.fileName","attached.filePath"];return d&&m.push("main.taskWfId"),{query:{fields:m,joins:["task","iq","is","priority","staff","head","status","attached"],filters:o,getType:"ONE"}}}static getPlanSubDetail(o){return{query:{fields:["main.id","main.docYear","main.taskWfId","main.taskId","main.taskSubject","main.reportDetail","main.scheduledStart","main.scheduledEnd","main.selfTimeScore","main.selfQuantityScore","main.selfQualityScore","main.selfSatisfiedScore","main.selfCode","main.headTimeScore","main.headQuantityScore","main.headQualityScore","main.headSatisfiedScore","main.createdAt","main.headActionAt","main.comment","task.indicatorTime","task.indicatorQuantity","iq.id","iq.subject","is.id","is.subject","staff.staffCode","staff.firstName","staff.lastName","head.staffCode","head.firstName","head.lastName","status.icon","status.name","status.color","attached.fileName","attached.filePath"],joins:["task","iq","is","staff","head","status","attached"],filters:o,getType:"ONE"}}}}},875:(S,p,i)=>{i.d(p,{K:()=>n});class n{static getMany(o){return{query:{fields:["main.id","main.docYear","main.taskId","main.taskSubject","main.selfTimeScore","main.selfQuantityScore","main.selfQualityScore","main.selfSatisfiedScore","main.selfCode","main.createdAt","main.isLock","status.id","status.icon","status.name","status.color"],joins:["status"],filters:o,getType:"MANY"}}}static getDetail(o){return{query:{fields:["main.id","main.docYear","main.taskId","main.taskSubject","main.reportDetail","main.scheduledStart","main.scheduledEnd","main.selfTimeScore","main.selfQuantityScore","main.selfQualityScore","main.selfSatisfiedScore","main.selfCode","main.createdAt","main.headActionAt","main.comment","task.id","task.indicatorTime","task.indicatorQuantity","iq.id","iq.subject","is.id","is.subject","staff.staffCode","staff.firstName","staff.lastName","head.staffCode","head.firstName","head.lastName","status.icon","status.name","status.color","attached.attachRefId","attached.docRefId","attached.fileName","attached.filePath"],joins:["task","iq","is","staff","head","status","attached"],filters:o,getType:"ONE"}}}static getStatus(o){return{query:{fields:["main.id","status.id","status.name","status.icon","status.color"],joins:["status"],filters:o,getType:"ONE"}}}}},9169:(S,p,i)=>{i.d(p,{N:()=>f});var n=i(1135),l=i(8505),o=i(4004),d=i(2340),m=i(8274),h=i(529);let f=(()=>{class u{constructor(s){this.http=s,this.apiUrl=`${d.N.apiUrl}/v1/plan-sub-evaluations`,this.item=new n.X(null),this.item$=this.item.asObservable(),this.items=new n.X([]),this.items$=this.items.asObservable()}getOne(s){return this.http.post(`${this.apiUrl}/find`,s).pipe((0,l.b)(t=>{200===t?.statusCode&&t?.data&&this.item.next(t.data)}))}getMany(s){return this.http.post(`${this.apiUrl}/find`,s).pipe((0,l.b)(t=>{200===t?.statusCode&&t?.data&&this.items.next(t.data)}))}update(s,a){return this.http.patch(`${this.apiUrl}/head/${s}`,a).pipe((0,o.U)(e=>{if(200===e?.statusCode&&e?.data){const _=this.items.getValue().map(E=>E.id===s?{...E,...a}:E);return this.items.next(_),!0}return!1}))}updateAndRemove(s,a){return this.http.patch(`${this.apiUrl}/head/${s}`,a).pipe((0,l.b)(e=>{200===e?.statusCode&&this.removeItemFromList(s)}))}removeItemFromList(s){const t=this.items.getValue().filter(e=>e?.id!==s);this.items.next(t)}}return u.\u0275fac=function(s){return new(s||u)(m.LFG(h.eN))},u.\u0275prov=m.Yz7({token:u,factory:u.\u0275fac,providedIn:"root"}),u})()},9504:(S,p,i)=>{i.d(p,{w:()=>u});var n=i(1135),l=i(4004),o=i(8505),d=i(2340),m=i(8274),h=i(529),f=i(3678);let u=(()=>{class c{constructor(a,t){this.http=a,this.planSubWfService=t,this.apiUrl=`${d.N.apiUrl}/v1/plan-sub-evaluations`,this.item=new n.X({}),this.item$=this.item.asObservable(),this.items=new n.X([]),this.items$=this.items.asObservable()}create(a){return this.http.post(this.apiUrl,a).pipe((0,l.U)(t=>{if(201===t.statusCode&&t.data)return this.planSubWfService.updateItems(t.data),t.data}))}getOne(a){return this.http.post(`${this.apiUrl}/find`,a).pipe((0,o.b)(e=>{200===e?.statusCode&&e?.data&&this.item.next(e.data)}))}getOneAndReplace(a){return this.http.post(`${this.apiUrl}/find`,a).pipe((0,o.b)(e=>{if(200===e?.statusCode&&e?.data){const r=e.data,_=this.items.getValue();if(-1!==_.findIndex(v=>v.id===r.id)){const v=_.map(M=>M.id===r.id?{...M,...r}:M);this.items.next([...v])}}}))}getMany(a){return this.http.post(`${this.apiUrl}/find`,a).pipe((0,o.b)(e=>{200===e?.statusCode&&e?.data&&this.items.next(e.data)}))}update(a,t){return this.http.patch(`${this.apiUrl}/${a}`,t).pipe((0,o.b)(r=>200===r?.statusCode))}deleteOne(a){return this.http.delete(`${this.apiUrl}/${a}`).pipe((0,l.U)(e=>200===e?.statusCode),(0,o.b)(e=>{e&&this.removeItemFromList(a)}))}removeItemFromList(a){const e=this.items.getValue().filter(r=>r?.id!==a);this.items.next(e)}}return c.\u0275fac=function(a){return new(a||c)(m.LFG(h.eN),m.LFG(f.K))},c.\u0275prov=m.Yz7({token:c,factory:c.\u0275fac,providedIn:"root"}),c})()},3119:(S,p,i)=>{i.d(p,{$:()=>f});var n=i(4004),l=i(8505),o=i(1135),d=i(2340),m=i(8274),h=i(529);let f=(()=>{class u{constructor(s){this.http=s,this.apiUrl=`${d.N.apiUrl}/v1/plan-main-wf`,this.planSubApiUrl=`${d.N.apiUrl}/v1/plan-subs`,this.items=new o.X([]),this.items$=this.items.asObservable()}create(s){return this.http.post(this.apiUrl,s).pipe((0,n.U)(a=>!(201!==a?.statusCode||!a?.data)))}addNewSubTask(s,a){const t=this.items.getValue(),e=t.findIndex(r=>r.id===s);if(-1!==e){const r={...t[e]};r.planMain||(r.planMain={planSubs:[]});const _=r.planMain.planSubs||[];_.unshift(a),_.sort((E,v)=>v.id-E.id),r.planMain.planSubs=_,t[e]=r,this.items.next([...t])}}getMany(s){return this.http.post(`${this.apiUrl}/find`,s).pipe((0,l.b)(t=>{200===t?.statusCode&&t?.data&&this.items.next(t.data)}))}getManyPlanSub(s,a){return this.http.post(`${this.planSubApiUrl}/find`,a).pipe((0,l.b)(e=>{if(200===e?.statusCode&&e?.data){const r=e.data,_=this.items.getValue(),E=_.find(v=>v.planMainId===s);E&&(E.planSubs=r,this.items.next(_))}}))}getOnePlanSubAndReplace(s){return this.http.post(this.planSubApiUrl,s).pipe((0,l.b)(t=>{}))}updateWorkflow(s,a,t){const e=this.items.getValue(),r=e.findIndex(_=>_.id===s);if(-1!==r){const _={...e[r]};_.planMain||(_.planMain={planSubs:[]});const E=_.planMain.planSubs||[],v=E.findIndex(M=>M.id===a);if(-1!==v){const M={...E[v]};M.planSubWf=t,E[v]=M,_.planMain.planSubs=E,e[r]=_,this.items.next([...e])}}}getAll(s,a){return this.http.get(`${this.apiUrl}/${s}`,{params:a}).pipe((0,l.b)(e=>{200===e?.statusCode&&e?.data&&this.items.next(e.data)}))}removePlanSub(s,a){const t=this.items.getValue(),e=t.findIndex(r=>r?.id===s);if(-1!==e){const r=t[e],_=r.planSubs?.filter(M=>M.id!==a)||[],E={...r,planSubs:_},v=[...t.slice(0,e),E,...t.slice(e+1)];this.items.next(v)}}deleteMany(s){return this.http.delete(`${this.apiUrl}/${s}`).pipe((0,n.U)(t=>200===t?.statusCode))}}return u.\u0275fac=function(s){return new(s||u)(m.LFG(h.eN))},u.\u0275prov=m.Yz7({token:u,factory:u.\u0275fac,providedIn:"root"}),u})()},9641:(S,p,i)=>{i.d(p,{N:()=>c});var n=i(7053),l=i(875),o=i(6522),d=i(8274),m=i(8386),h=i(3678),f=i(9504),u=i(9169);let c=(()=>{class s{constructor(t,e,r,_){this.userService=t,this.staffWfService=e,this.selfEvalService=r,this.headEvalService=_}createFilter(t,e){const r=this.userService.getLoggedUser()?.profile?.staffCode;return{docYear:t,[e]:r}}getTaskIn(t){const e=this.createFilter(t,"staffCode"),r=n.e.getMany(e);return this.staffWfService.getMany(r)}getTaskReport(t){const e=this.createFilter(t,"selfCode"),r=l.K.getMany(e);return this.selfEvalService.getMany(r)}getTaskEval(t){const e=this.createFilter(t,"headActionBy"),r=o._.getMany(e);return this.headEvalService.getMany(r)}}return s.\u0275fac=function(t){return new(t||s)(d.LFG(m.K),d.LFG(h.K),d.LFG(f.w),d.LFG(u.N))},s.\u0275prov=d.Yz7({token:s,factory:s.\u0275fac,providedIn:"root"}),s})()},3678:(S,p,i)=>{i.d(p,{K:()=>u});var n=i(4004),l=i(8505),o=i(1135),d=i(2340),m=i(8274),h=i(529),f=i(3119);let u=(()=>{class c{constructor(a,t){this.http=a,this.planMainWfService=t,this.apiUrl=`${d.N.apiUrl}/v1/plan-sub-wf-staffs`,this.items=new o.X([]),this.items$=this.items.asObservable(),this.item=new o.X(null),this.item$=this.item.asObservable()}create(a,t,e){return this.http.post(this.apiUrl,e).pipe((0,n.U)(r=>!(201!==r?.statusCode||!r?.data||(this.planMainWfService.updateWorkflow(a,t,r.data),0))))}forwardWf(a){return this.http.post(`${this.apiUrl}/forward`,a).pipe((0,l.b)(e=>{201===e?.statusCode&&e?.data&&this.updateItems(e.data)}))}getOne(a){return this.http.post(`${this.apiUrl}/find`,a).pipe((0,l.b)(e=>{200===e?.statusCode&&e?.data&&this.item.next(e.data)}))}getMany(a){return this.http.post(`${this.apiUrl}/find`,a).pipe((0,l.b)(e=>{200===e?.statusCode&&e?.data&&this.items.next(e.data)}))}update(a,t){return this.http.patch(this.apiUrl,t,{params:a}).pipe((0,l.b)(e=>{if(200===e?.statusCode&&e?.data){const r=e.data,E=this.items.getValue().map(v=>v?.id===r.id?r:v);this.items.next(E)}}))}pickup(a,t){return this.http.patch(`${this.apiUrl}/pickup`,t,{params:a}).pipe((0,l.b)(r=>{200===r?.statusCode&&r?.data&&this.updateItems(r.data)}))}deleteMany(a){return this.http.delete(`${this.apiUrl}/${a}`).pipe((0,n.U)(e=>200===e?.statusCode))}updateItems(a){const e=this.items.getValue().map(r=>r?.id===a.id?{...r,status:a.status}:r);this.items.next(e)}}return c.\u0275fac=function(a){return new(a||c)(m.LFG(h.eN),m.LFG(f.$))},c.\u0275prov=m.Yz7({token:c,factory:c.\u0275fac,providedIn:"root"}),c})()},7053:(S,p,i)=>{i.d(p,{e:()=>n});class n{static getMany(o){return{query:{fields:["main.docYear","main.id","main.createdAt","creator.staffCode","creator.firstName","creator.lastName","planSub.id","planSub.taskSubject","planSub.taskWeight","planSub.indicatorTime","planSub.indicatorQuantity","psubIq.id","psubIq.subject","psubIs.id","psubIs.subject","wfStatus.id","wfStatus.name","wfStatus.icon","wfStatus.color"],joins:["creator","planSub","psubIq","psubIs","psubStatus","wfStatus"],filters:o,getType:"MANY"}}}}}}]);