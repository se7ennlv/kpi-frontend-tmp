"use strict";(self.webpackChunkavalon_ng=self.webpackChunkavalon_ng||[]).push([[4782],{4782:(Wt,Q,s)=>{s.r(Q),s.d(Q,{KpiDeptApprModule:()=>Ht});var E=s(6895),N=s(5675),Y=s(7579),F=s(2722),T=s(9491),H=s(4131);class q{static getOneAfterApproved(o){return{query:{fields:["main.id","main.deptGrade","main.deptComment"],joins:[],filters:o,getType:"ONE"}}}static getMany(o){return{query:{fields:["main.id","main.batchCode","main.staffCode","main.firstName","main.lastName","main.positionName","main.divisionId","main.divisionName","main.taskPlanScore","main.taskAssignScore","main.taskDescScore","main.taskCalcScore","main.attendScore","main.finalScore","main.sysGrade","main.divGrade","main.deptApproved","main.deptGrade"],joins:[],filters:o,getType:"MANY"}}}static getDetail(o){return{query:{fields:["main.id","main.staffCode","main.firstName","main.lastName","main.positionName","main.divisionName","main.taskPlanScore","main.taskAssignScore","main.taskDescScore","main.taskCalcScore","main.attendScore","main.finalScore","main.sysGrade","main.divGrade","main.divComment","main.divActionAt","main.deptGrade","main.deptComment","main.deptActionAt"],joins:[],filters:o,getType:"ONE"}}}}var p=s(2156),A=s(655);class v{}(0,A.gn)([(0,p.C1)()],v.prototype,"batchCode",void 0),(0,A.gn)([(0,p.C1)()],v.prototype,"departmentId",void 0),(0,A.gn)([(0,p.C1)()],v.prototype,"comment",void 0);var t=s(8274),U=s(704),c=s(4325),y=s(1135),j=s(4004),C=s(8505),f=s(2340),z=s(529);let Z=(()=>{class i{constructor(e){this.http=e,this.apiUrl=`${f.N.apiUrl}/v1/report-staff-score`,this.divApproved=new y.X(!1),this.divApproved$=this.divApproved.asObservable(),this.item=new y.X({}),this.item$=this.item.asObservable(),this.items=new y.X([]),this.items$=this.items.asObservable()}countEvalStaff(e){return this.http.get(`${f.N.apiUrl}/v1/sum-staff-score/count`,{params:e}).pipe((0,j.U)(n=>200===n?.statusCode&&n?.data?.rowCount?n?.data?.rowCount:0))}getOne(e){return this.http.post(`${this.apiUrl}/find`,e).pipe((0,C.b)(n=>{200===n?.statusCode&&n?.data&&this.item.next(n.data)}))}getOneAndReplace(e){return this.http.post(`${this.apiUrl}/find`,e).pipe((0,C.b)(n=>{if(200===n?.statusCode&&n?.data){const a=n.data,l=this.items.getValue();if(-1!==l?.findIndex(g=>g.id===a.id)){const g=l?.map(m=>m.id===a.id?{...m,...a}:m);this.items.next([...g])}}}))}getMany(e){return this.http.post(`${this.apiUrl}/find`,e).pipe((0,C.b)(n=>{200===n?.statusCode&&n?.data&&this.items.next(n.data)}))}update(e,u,n){return this.http.patch(`${f.N.apiUrl}/v1/sum-staff-score/${n}/${e}`,u).pipe((0,C.b)(l=>{if(200===l?.statusCode&&l?.data){const d=l.data,m=this.items.value?.map(D=>D?.id===d.id?d:D);this.items.next(m)}}))}approve(e,u){return this.http.patch(`${f.N.apiUrl}/v1/sum-staff-score/${u}`,e).pipe((0,C.b)(a=>{}))}getDetail(e){if(e){const n=q.getDetail({id:e});this.getOne(n).subscribe()}}checkConfirmStatus(e){return this.http.get(`${f.N.apiUrl}/v1/kpi-dept-appr/count`,{params:e}).pipe((0,j.U)(n=>{const a=200===n?.statusCode&&n?.data?.rowCount>0;return this.divApproved.next(a),a}))}}return i.\u0275fac=function(e){return new(e||i)(t.LFG(z.eN))},i.\u0275prov=t.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var K=s(841),r=s(433),B=s(5593),S=s(3054);function L(i,o){if(1&i&&(t.TgZ(0,"small",12),t._uU(1),t.qZA()),2&i){const e=t.oxw();t.xp6(1),t.hij(" *",null==e.controls.comment.errors.required?null:e.controls.comment.errors.required.message," ")}}let V=(()=>{class i{constructor(e,u,n,a,l,d){this.fb=e,this.alertService=u,this.dialogRef=n,this.dialogConfig=a,this.apprService=l,this.formService=d,this.submitted=!1,p.jc.set(this.formService.validationMessages)}get controls(){return this.formGroup.controls}ngOnInit(){this.formGroup=this.fb.formGroup(new v),this.dialogData=this.dialogConfig.data.data,this.dialogData&&this.formGroup.patchValue({...this.dialogData})}onSubmit(){if(this.submitted=!0,this.formGroup.invalid)return;const e=this.formGroup.value;this.formGroup.disable(),console.log(e),this.apprService.approve(e,"dept-approve").subscribe({next:u=>{u&&(this.closeDialog(),this.alertService.showSuccess("\u0e9a\u0eb1\u0e99\u0e97\u0eb6\u0e81\u0e82\u0ecd\u0ec9\u0ea1\u0eb9\u0e99\u0ec1\u0ea5\u0ec9\u0ea7"),setTimeout(()=>{window.location.reload()},2e3))},error:u=>{this.alertService.showError(u)}})}closeDialog(){this.formGroup.reset(),this.formGroup.enable(),this.dialogRef?.close()}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(p.GW),t.Y36(U.c),t.Y36(c.E7),t.Y36(c.S),t.Y36(Z),t.Y36(K.k))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-approve-dialog"]],decls:17,vars:6,consts:[[1,"grid","p-fluid"],[1,"col-12"],[1,"p-2","h-20rem"],["autocomplete","off",3,"formGroup"],[1,"field"],["for","comment",1,"font-semibold","text-lg","mb-0"],["class","p-error",4,"ngIf"],["id","comment","rows","3","cols","30","pInputTextarea","","formControlName","comment","placeholder","\u0e81\u0eb0\u0ea5\u0eb8\u0e99\u0eb2\u0e9b\u0ec9\u0ead\u0e99\u0e84\u0eb3\u0ec0\u0eab\u0eb1\u0e99\u0ec3\u0e99\u0e81\u0eb2\u0e99\u0ead\u0eb0\u0e99\u0eb8\u0ea1\u0eb1\u0e94\u0ec2\u0e94\u0e8d\u0ea5\u0ea7\u0ea1\u0e82\u0ead\u0e87\u0e97\u0ec8\u0eb2\u0e99",3,"autoResize"],[1,"text-red-500","mt-2"],[1,"p-dialog-footer","w-full","fixed","left-0","bottom-0","py-4"],["pButton","","pRipple","","label","\u0e8d\u0ebb\u0e81\u0ec0\u0ea5\u0eb5\u0e81","icon","pi pi-times",1,"p-button-outlined",3,"disabled","click"],["pButton","","pRipple","","icon","pi pi-check","label","\u0ea2\u0eb7\u0e99\u0ea2\u0eb1\u0e99","icon","pi pi-check",3,"loading","disabled","click"],[1,"p-error"]],template:function(e,u){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"form",3)(4,"div",4)(5,"label",5),t._uU(6," \u0e84\u0eb3\u0ec0\u0eab\u0eb1\u0e99\u0e82\u0ead\u0e87\u0e97\u0ec8\u0eb2\u0e99 "),t.YNc(7,L,2,1,"small",6),t.qZA(),t.TgZ(8,"textarea",7),t._uU(9,"                    "),t.qZA(),t.TgZ(10,"div",8)(11,"span"),t._uU(12,"*"),t.qZA(),t._uU(13," \u0e81\u0eb0\u0ea5\u0eb8\u0e99\u0eb2\u0e81\u0ea7\u0e94\u0eaa\u0ead\u0e9a\u0e82\u0ecd\u0ec9\u0ea1\u0eb9\u0e99\u0e82\u0ead\u0e87\u0eaa\u0eb0\u0ea1\u0eb2\u0e8a\u0eb4\u0e81\u0ec3\u0eab\u0ec9\u0e96\u0eb7\u0e81\u0e95\u0ec9\u0ead\u0e87 \u0ec1\u0ea5\u0eb0 \u0e97\u0ec8\u0eb2\u0e99\u0ec4\u0e94\u0ec9\u0e9b\u0eb1\u0e9a\u0ec0\u0e81\u0ea3\u0e94\u0e95\u0eb2\u0ea1\u0e84\u0ea7\u0eb2\u0ea1\u0ec0\u0edd\u0eb2\u0eb0\u0eaa\u0ebb\u0ea1\u0ec1\u0ea5\u0ec9\u0ea7\u0e9a\u0ecd\u0ec8?, \u0e97\u0ec8\u0eb2\u0e99\u0e88\u0eb0\u0e9a\u0ecd\u0ec8\u0eaa\u0eb2\u0ea1\u0eb2\u0e94\u0ec1\u0e81\u0ec9\u0ec4\u0e82\u0e82\u0ecd\u0ec9\u0ea1\u0eb9\u0e99\u0ec4\u0e94\u0ec9\u0eab\u0ebc\u0eb1\u0e87\u0e88\u0eb2\u0e81\u0e81\u0ebb\u0e94\u0e9b\u0eb8\u0ec8\u0ea1\u0ea2\u0eb7\u0e99\u0ea2\u0eb1\u0e99. "),t.qZA()()()(),t.TgZ(14,"div",9)(15,"button",10),t.NdJ("click",function(){return u.closeDialog()}),t.qZA(),t.TgZ(16,"button",11),t.NdJ("click",function(){return u.onSubmit()}),t.qZA()()()()),2&e&&(t.xp6(3),t.Q6J("formGroup",u.formGroup),t.xp6(4),t.Q6J("ngIf",u.submitted&&u.controls.comment.errors),t.xp6(1),t.Q6J("autoResize",!0),t.xp6(7),t.Q6J("disabled",u.formGroup.disabled),t.xp6(1),t.Q6J("loading",u.formGroup.disabled)("disabled",u.formGroup.disabled))},dependencies:[E.O5,r._Y,r.Fj,r.JJ,r.JL,r.sg,r.u,p.bc,p.VP,p.YE,B.Hq,S.g],encapsulation:2}),i})();var X=s(8145),W=s(1094),tt=s(6832),G=s(8039),et=s(2569),ut=s(5143),I=s(8386),M=s(585),_=s(805),J=s(793),k=s(1740),O=s(6679),$=s(666),b=s(7147),R=s(209),w=s(2946);function it(i,o){1&i&&(t.TgZ(0,"span",17),t._uU(1,"\u0e82\u0ecd\u0ec9\u0ea1\u0eb9\u0e99\u0e9e\u0eb0\u0e99\u0eb1\u0e81\u0e87\u0eb2\u0e99"),t.qZA())}function nt(i,o){1&i&&(t.TgZ(0,"span",17),t._uU(1,"\u0e81\u0eb2\u0e99\u0ead\u0eb0\u0e99\u0eb8\u0ea1\u0eb1\u0e94 (\u0e82\u0eb1\u0ec9\u0e99\u0e9e\u0eb0\u0ec1\u0e99\u0e81)"),t.qZA())}function ot(i,o){1&i&&(t.TgZ(0,"span",17),t._uU(1,"\u0e81\u0eb2\u0e99\u0ead\u0eb0\u0e99\u0eb8\u0ea1\u0eb1\u0e94 (\u0e82\u0eb1\u0ec9\u0e99\u0e9d\u0ec8\u0eb2\u0e8d)"),t.qZA())}function st(i,o){if(1&i&&(t.TgZ(0,"p-fieldset",12),t.YNc(1,ot,2,0,"ng-template",4),t.TgZ(2,"div",5)(3,"div",1)(4,"label",13),t._uU(5,"\u0ec0\u0e81\u0ea3\u0e94\u0ead\u0eb0\u0e99\u0eb8\u0ea1\u0eb1\u0e94:"),t.qZA(),t._UZ(6,"p-chip",11),t.qZA(),t.TgZ(7,"div",14)(8,"label",13),t._uU(9,"\u0ea7\u0eb1\u0e99\u0e97\u0eb5\u0e9b\u0eb1\u0e9a\u0ec0\u0e81\u0ea3\u0e94:"),t.qZA(),t._uU(10),t.ALo(11,"date"),t.qZA(),t.TgZ(12,"div",14)(13,"label",18),t._uU(14,"\u0e84\u0eb3\u0ec0\u0eab\u0eb1\u0e99 "),t.qZA(),t.TgZ(15,"div"),t._uU(16),t.qZA()()()()),2&i){const e=t.oxw().ngIf,u=t.oxw();t.Q6J("toggleable",!0),t.xp6(6),t.s9C("label",e.deptGrade),t.Q6J("styleClass",u.gradeService.getGradeClass(e.deptGrade)+" text-white font-bold px-3"),t.xp6(4),t.hij(" ",t.xi3(11,5,null==e?null:e.deptActionAt,"dd/MM/yyyy HH:mm")," "),t.xp6(6),t.Oqu(null==e?null:e.deptComment)}}function at(i,o){if(1&i&&(t.ynx(0),t.TgZ(1,"p-fieldset",3),t.YNc(2,it,2,0,"ng-template",4),t.TgZ(3,"div",5)(4,"div",6)(5,"label",7),t._uU(6,"\u0ea5\u0eb0\u0eab\u0eb1\u0e94 \u0e9f\u0e9f\u0ea5: "),t.qZA(),t.TgZ(7,"span",8),t._uU(8),t.qZA()(),t.TgZ(9,"div",6)(10,"label",7),t._uU(11,"\u0e8a\u0eb7\u0ec8 \u0ec1\u0ea5\u0eb0 \u0e99\u0eb2\u0ea1\u0eaa\u0eb0\u0e81\u0eb8\u0e99:"),t.qZA(),t.TgZ(12,"span",8),t._uU(13),t.qZA()(),t.TgZ(14,"div",6)(15,"label",7),t._uU(16,"\u0e95\u0eb3\u0ec1\u0edc\u0ec8\u0e87:"),t.qZA(),t.TgZ(17,"span",8),t._uU(18),t.qZA()(),t.TgZ(19,"div",9)(20,"label",7),t._uU(21,"\u0e9e\u0eb0\u0ec1\u0e99\u0e81:"),t.qZA(),t.TgZ(22,"span",8),t._uU(23),t.qZA()(),t.TgZ(24,"div",6)(25,"label",10),t._uU(26,"\u0ec0\u0e81\u0ea3\u0e94\u0e84\u0eb3\u0e99\u0ea7\u0e99:"),t.qZA(),t._UZ(27,"p-chip",11),t.qZA()()(),t.TgZ(28,"p-fieldset",12),t.YNc(29,nt,2,0,"ng-template",4),t.TgZ(30,"div",5)(31,"div",1)(32,"label",13),t._uU(33,"\u0ec0\u0e81\u0ea3\u0e94\u0ead\u0eb0\u0e99\u0eb8\u0ea1\u0eb1\u0e94:"),t.qZA(),t._UZ(34,"p-chip",11),t.qZA(),t.TgZ(35,"div",14)(36,"label",13),t._uU(37,"\u0ea7\u0eb1\u0e99\u0e97\u0eb5\u0e9b\u0eb1\u0e9a\u0ec0\u0e81\u0ea3\u0e94:"),t.qZA(),t._uU(38),t.ALo(39,"date"),t.qZA(),t.TgZ(40,"div",14)(41,"label",15),t._uU(42,"\u0e84\u0eb3\u0ec0\u0eab\u0eb1\u0e99 "),t.qZA(),t.TgZ(43,"div"),t._uU(44),t.qZA()()()(),t.YNc(45,st,17,8,"p-fieldset",16),t.BQk()),2&i){const e=o.ngIf,u=t.oxw();t.xp6(1),t.Q6J("toggleable",!0),t.xp6(7),t.Oqu(e.staffCode),t.xp6(5),t.AsE("",e.firstName," ",e.lastName,""),t.xp6(5),t.Oqu(e.positionName),t.xp6(5),t.Oqu(e.divisionName),t.xp6(4),t.s9C("label",e.sysGrade),t.Q6J("styleClass",u.gradeService.getGradeClass(e.sysGrade)+" text-white font-bold px-3"),t.xp6(1),t.Q6J("toggleable",!0),t.xp6(6),t.s9C("label",e.divGrade),t.Q6J("styleClass",u.gradeService.getGradeClass(e.divGrade)+" text-white font-bold px-3"),t.xp6(4),t.hij(" ",t.xi3(39,14,null==e?null:e.divActionAt,"dd/MM/yyyy HH:mm")," "),t.xp6(6),t.Oqu(null==e?null:e.divComment),t.xp6(1),t.Q6J("ngIf",4===u.userRoleId)}}let lt=(()=>{class i{constructor(e,u,n,a){this.gradeService=e,this.apprService=u,this.dialogConfig=n,this.userService=a,this.destroy$=new Y.x}ngOnInit(){this.docId=this.dialogConfig.data.data,this.user=this.userService.getLoggedUser(),this.userRoleId=this.user?.role?.id,this.docId&&(this.apprService.getDetail(this.docId),this.item$=this.apprService.item$)}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(G.U),t.Y36(Z),t.Y36(c.S),t.Y36(I.K))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-detail-dialog"]],decls:4,vars:3,consts:[[1,"grid"],[1,"col-12"],[4,"ngIf"],[3,"toggleable"],["pTemplate","header"],[1,"formgrid","grid","p-fluid"],[1,"col-12","text-xl"],[1,"font-semibold","mb-0"],[1,"ml-2"],[1,"field","col-12","text-xl"],[1,"font-semibold","mb-0","mr-2"],[3,"label","styleClass"],["styleClass","mt-4",3,"toggleable"],[1,"font-semibold","text-xl","mb-0","mr-2"],[1,"field","col-12"],["for","comment",1,"font-semibold","text-xl","mb-0"],["styleClass","mt-4",3,"toggleable",4,"ngIf"],[1,"font-semibold","text-xl"],["for","comment",1,"font-semibold","text-lg","mb-0"]],template:function(e,u){1&e&&(t.TgZ(0,"div",0)(1,"div",1),t.YNc(2,at,46,17,"ng-container",2),t.ALo(3,"async"),t.qZA()()),2&e&&(t.xp6(2),t.Q6J("ngIf",t.lcZ(3,1,u.item$)))},dependencies:[E.O5,_.jx,w.p,b.A,E.Ov,E.uU],encapsulation:2}),i})();class x{}(0,A.gn)([(0,p.C1)()],x.prototype,"batchCode",void 0),(0,A.gn)([(0,p.C1)()],x.prototype,"staffCode",void 0),(0,A.gn)([(0,p.C1)()],x.prototype,"deptGrade",void 0),(0,A.gn)([(0,p.C1)()],x.prototype,"deptComment",void 0);var pt=s(2048);function rt(i,o){1&i&&(t.TgZ(0,"span",21),t._uU(1,"\u0e82\u0ecd\u0ec9\u0ea1\u0eb9\u0e99\u0e9e\u0eb0\u0e99\u0eb1\u0e81\u0e87\u0eb2\u0e99"),t.qZA())}function Et(i,o){1&i&&(t.TgZ(0,"span",21),t._uU(1,"\u0e81\u0eb2\u0e99\u0ead\u0eb0\u0e99\u0eb8\u0ea1\u0eb1\u0e94"),t.qZA())}function dt(i,o){if(1&i&&(t.TgZ(0,"div",8)(1,"label",9),t._uU(2,"\u0ec0\u0e81\u0ea3\u0e94\u0e97\u0eb5\u0ec8\u0ec3\u0eab\u0ec9\u0e81\u0ec8\u0ead\u0e99\u0edc\u0ec9\u0eb2:"),t.qZA(),t._UZ(3,"p-chip",10),t.qZA()),2&i){const e=t.oxw();t.xp6(3),t.s9C("label",e.item.deptGrade),t.Q6J("styleClass",e.gradeService.getGradeClass(e.item.deptGrade)+" text-white font-bold px-3")}}function ct(i,o){if(1&i&&(t.TgZ(0,"small",22),t._uU(1),t.qZA()),2&i){const e=t.oxw();t.xp6(1),t.hij(" *",null==e.controls.deptComment.errors.required?null:e.controls.deptComment.errors.required.message," ")}}let mt=(()=>{class i{constructor(e,u,n,a,l,d,g,m){this.gradeService=e,this.fb=u,this.alertService=n,this.formService=a,this.dialogRef=l,this.dialogConfig=d,this.userService=g,this.apprService=m,this.submitted=!1,this.formGroup=this.fb.formGroup(new x),p.jc.set(this.formService.validationMessages)}get controls(){return this.formGroup.controls}ngOnInit(){this.item=this.dialogConfig.data.data,this.user=this.userService.getLoggedUser(),this.userRoleId=this.user?.role?.id,this.initData()}initData(){this.formGroup.patchValue({batchCode:this.item?.batchCode,staffCode:this.item?.staffCode})}onSubmit(){if(this.submitted=!0,this.formGroup.invalid)return;const e=this.item?.id,u={batchCode:this.item?.batchCode,staffCode:this.item?.staffCode,...this.formGroup.value};this.apprService.update(e,u,"dept").subscribe({next:n=>{n&&(this.closeDialog(),this.getOneItem(e),this.alertService.showSuccess("\u0e9b\u0eb1\u0e9a\u0ec0\u0e81\u0ea3\u0e94\u0eae\u0ebd\u0e9a\u0eae\u0ec9\u0ead\u0e8d\u0ec1\u0ea5\u0ec9\u0ea7"))},error:n=>{this.closeDialog(),this.alertService.showError(n)}})}getOneItem(e){const n=q.getOneAfterApproved({id:e});this.apprService.getOneAndReplace(n).subscribe()}closeDialog(){this.submitted=!1,this.formGroup.reset(),this.formGroup.enable(),this.dialogRef?.close()}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(G.U),t.Y36(p.GW),t.Y36(U.c),t.Y36(K.k),t.Y36(c.E7),t.Y36(c.S),t.Y36(I.K),t.Y36(Z))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-adjust-dialog"]],decls:44,vars:21,consts:[[1,"p-2"],["autocomplete","off",3,"formGroup"],[3,"toggleable"],["pTemplate","header"],[1,"formgrid","grid","p-fluid"],[1,"col-12","text-xl"],[1,"font-semibold","mb-0"],[1,"ml-2"],[1,"field","col-12","text-xl"],[1,"font-semibold","mb-0","mr-2"],[3,"label","styleClass"],["styleClass","mt-4",3,"toggleable"],["class","field col-12 text-xl",4,"ngIf"],[1,"field","col-12"],[3,"formControlName","submitted","label","textLabelSize"],["for","comment",1,"font-semibold","text-xl","mb-0"],["class","p-error",4,"ngIf"],["id","comment","rows","3","cols","30","pInputTextarea","",3,"autoResize","formControlName"],[1,"text-right","sticky","bottom-0","mt-5"],["pButton","","pRipple","","label","\u0e8d\u0ebb\u0e81\u0ec0\u0ea5\u0eb5\u0e81","icon","pi pi-times",1,"p-button-outlined",3,"disabled","click"],["pButton","","pRipple","","icon","pi pi-share-alt","label","\u0e9a\u0eb1\u0e99\u0e97\u0eb6\u0e81","icon","pi pi-check",1,"ml-2",3,"loading","disabled","click"],[1,"font-semibold","text-xl"],[1,"p-error"]],template:function(e,u){1&e&&(t.TgZ(0,"div",0)(1,"form",1)(2,"p-fieldset",2),t.YNc(3,rt,2,0,"ng-template",3),t.TgZ(4,"div",4)(5,"div",5)(6,"label",6),t._uU(7,"\u0ea5\u0eb0\u0eab\u0eb1\u0e94 \u0e9f\u0e9f\u0ea5: "),t.qZA(),t.TgZ(8,"span",7),t._uU(9),t.qZA()(),t.TgZ(10,"div",5)(11,"label",6),t._uU(12,"\u0e8a\u0eb7\u0ec8 \u0ec1\u0ea5\u0eb0 \u0e99\u0eb2\u0ea1\u0eaa\u0eb0\u0e81\u0eb8\u0e99:"),t.qZA(),t.TgZ(13,"span",7),t._uU(14),t.qZA()(),t.TgZ(15,"div",5)(16,"label",6),t._uU(17,"\u0e95\u0eb3\u0ec1\u0edc\u0ec8\u0e87:"),t.qZA(),t.TgZ(18,"span",7),t._uU(19),t.qZA()(),t.TgZ(20,"div",8)(21,"label",6),t._uU(22,"\u0e9e\u0eb0\u0ec1\u0e99\u0e81:"),t.qZA(),t.TgZ(23,"span",7),t._uU(24),t.qZA()(),t.TgZ(25,"div",5)(26,"label",9),t._uU(27,"\u0ec0\u0e81\u0ea3\u0e94\u0e84\u0eb3\u0e99\u0ea7\u0e99:"),t.qZA(),t._UZ(28,"p-chip",10),t.qZA()()(),t.TgZ(29,"p-fieldset",11),t.YNc(30,Et,2,0,"ng-template",3),t.TgZ(31,"div",4),t.YNc(32,dt,4,2,"div",12),t.TgZ(33,"div",13),t._UZ(34,"app-dropdown-grade",14),t.qZA(),t.TgZ(35,"div",13)(36,"label",15),t._uU(37,"\u0e84\u0eb3\u0ec0\u0eab\u0eb1\u0e99\u0e82\u0ead\u0e87\u0e97\u0ec8\u0eb2\u0e99 "),t.YNc(38,ct,2,1,"small",16),t.qZA(),t.TgZ(39,"textarea",17),t._uU(40,"                        "),t.qZA()()()()()(),t.TgZ(41,"div",18)(42,"button",19),t.NdJ("click",function(){return u.closeDialog()}),t.qZA(),t.TgZ(43,"button",20),t.NdJ("click",function(){return u.onSubmit()}),t.qZA()()),2&e&&(t.xp6(1),t.Q6J("formGroup",u.formGroup),t.xp6(1),t.Q6J("toggleable",!0),t.xp6(7),t.Oqu(u.item.staffCode),t.xp6(5),t.AsE("",u.item.firstName," ",u.item.lastName,""),t.xp6(5),t.Oqu(u.item.positionName),t.xp6(5),t.Oqu(u.item.divisionName),t.xp6(4),t.s9C("label",u.item.sysGrade),t.Q6J("styleClass",u.gradeService.getGradeClass(u.item.sysGrade)+" text-white font-bold px-3"),t.xp6(1),t.Q6J("toggleable",!0),t.xp6(3),t.Q6J("ngIf",u.item.deptGrade),t.xp6(2),t.Q6J("formControlName","deptGrade")("submitted",u.submitted)("label","\u0ec0\u0e81\u0ea3\u0e94\u0e97\u0eb5\u0ec8\u0ec0\u0eab\u0eb1\u0e99\u0ea7\u0ec8\u0eb2\u0ec0\u0edd\u0eb2\u0eb0\u0eaa\u0ebb\u0ea1")("textLabelSize","text-xl"),t.xp6(4),t.Q6J("ngIf",u.submitted&&u.controls.deptComment.errors),t.xp6(1),t.Q6J("autoResize",!0)("formControlName","deptComment"),t.xp6(3),t.Q6J("disabled",u.formGroup.disabled),t.xp6(1),t.Q6J("loading",u.formGroup.disabled)("disabled",u.formGroup.disabled))},dependencies:[E.O5,r._Y,r.Fj,r.JJ,r.JL,r.sg,r.u,p.bc,p.VP,p.YE,B.Hq,_.jx,w.p,b.A,S.g,pt.G],encapsulation:2}),i})();var P=s(605);function gt(i,o){if(1&i){const e=t.EpF();t.ynx(0),t.TgZ(1,"p-splitButton",3),t.NdJ("onClick",function(){t.CHM(e);const n=t.oxw(2);return t.KtG(n.adjustGrade())})("onDropdownClick",function(){t.CHM(e);const n=t.oxw(2);return t.KtG(n.setMenus())}),t.qZA(),t.BQk()}if(2&i){const e=t.oxw(2);t.xp6(1),t.Q6J("model",e.menuItems)}}function At(i,o){if(1&i){const e=t.EpF();t.TgZ(0,"p-button",4),t.NdJ("click",function(){t.CHM(e);const n=t.oxw(2);return t.KtG(n.showDetail())}),t.qZA()}}function ht(i,o){if(1&i&&(t.ynx(0),t.YNc(1,gt,2,1,"ng-container",0),t.YNc(2,At,1,0,"p-button",2),t.BQk()),2&i){const e=t.oxw();t.xp6(1),t.Q6J("ngIf",!e.item.deptApproved),t.xp6(1),t.Q6J("ngIf",e.item.deptApproved)}}function Ct(i,o){1&i&&(t.TgZ(0,"span",5),t._UZ(1,"i",6),t._uU(2," \u0e9a\u0ecd\u0ec8\u0ea1\u0eb5\u0e81\u0eb2\u0e99\u0e9b\u0eb0\u0ec0\u0ea1\u0eb5\u0e99"),t.qZA())}let ft=(()=>{class i{constructor(e,u,n){this.dialogRef=e,this.dialogService=u,this.confirmService=n,this.menuItems=[]}ngOnInit(){}setMenus(){this.menuItems=[{label:"\u0ea5\u0eb2\u0e8d\u0ea5\u0eb0\u0ead\u0ebd\u0e94",icon:"pi pi-fw pi-list",command:()=>this.showDetail()}]}adjustGrade(){this.dialogRef=this.dialogService.open(mt,{header:`\u0eaa\u0eb0\u0ec0\u0edc\u0eb5\u0e9e\u0eb4\u0e88\u0eb2\u0ea5\u0eb0\u0e99\u0eb2\u0e84\u0eb7\u0e99 #${this.item?.id}`,width:window.innerWidth>R.A.lg?"65%":"80%",data:{data:this.item},contentStyle:{overflow:"auto","padding-bottom":"20px"},baseZIndex:1e4,dismissableMask:!1,maximizable:!0})}showDetail(){this.item&&(this.dialogRef=this.dialogService.open(lt,{header:`\u0ea5\u0eb2\u0e8d\u0ea5\u0eb0\u0ead\u0ebd\u0e94 #${this.item?.id}`,width:window.innerWidth>R.A.lg?"65%":"80%",data:{data:this.item?.id},contentStyle:{overflow:"auto","padding-bottom":"20px"},baseZIndex:1e4,dismissableMask:!1,maximizable:!0}))}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(c.E7),t.Y36(c.xA),t.Y36(_.YP))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-btn-action"]],inputs:{item:"item"},decls:2,vars:2,consts:[[4,"ngIf"],["class","text-red-500 font-semibold",4,"ngIf"],["label","\u0ec0\u0e9a\u0eb4\u0ec8\u0e87\u0ea5\u0eb2\u0e8d\u0ea5\u0eb0\u0ead\u0ebd\u0e94","styleClass","p-button-secondary p-button-sm",3,"click",4,"ngIf"],["appendTo","body","icon","pi pi-sliders-v","label","\u0e9e\u0eb4\u0e88\u0eb2\u0ea5\u0eb0\u0e99\u0eb2","styleClass","p-button-secondary p-button-sm",3,"model","onClick","onDropdownClick"],["label","\u0ec0\u0e9a\u0eb4\u0ec8\u0e87\u0ea5\u0eb2\u0e8d\u0ea5\u0eb0\u0ead\u0ebd\u0e94","styleClass","p-button-secondary p-button-sm",3,"click"],[1,"text-red-500","font-semibold"],[1,"pi","pi-times"]],template:function(e,u){1&e&&(t.YNc(0,ht,3,2,"ng-container",0),t.YNc(1,Ct,3,0,"span",1)),2&e&&(t.Q6J("ngIf",u.item.taskCalcScore>0),t.xp6(1),t.Q6J("ngIf",u.item.taskCalcScore<=0))},dependencies:[E.O5,B.zx,P.a],encapsulation:2}),i})();function Bt(i,o){if(1&i&&(t.TgZ(0,"div",3)(1,"div"),t._uU(2),t.qZA()()),2&i){const e=o.$implicit;t.xp6(2),t.AsE("[",null==e?null:e.code,"]-",null==e?null:e.name,"")}}function xt(i,o){if(1&i&&(t.TgZ(0,"div"),t._uU(1),t.qZA()),2&i){const e=o.$implicit;t.xp6(1),t.AsE("[",null==e?null:e.code,"]-",null==e?null:e.name,"")}}function vt(i,o){1&i&&(t.TgZ(0,"tr")(1,"th",23),t._uU(2,"#"),t.qZA(),t.TgZ(3,"th",24),t._uU(4,"\u0ea5\u0eb0\u0eab\u0eb1\u0e94 \u0e9e/\u0e87"),t.qZA(),t.TgZ(5,"th",25),t._uU(6,"\u0e8a\u0eb7\u0ec8"),t.qZA(),t.TgZ(7,"th",25),t._uU(8,"\u0e99\u0eb2\u0ea1\u0eaa\u0eb0\u0e81\u0eb8\u0e99"),t.qZA(),t.TgZ(9,"th",25),t._uU(10,"\u0e95\u0eb3\u0ec1\u0edc\u0ec8\u0e87"),t.qZA(),t.TgZ(11,"th",24),t._uU(12,"\u0ea7\u0ebd\u0e81\u0ec1\u0e9c\u0e99\u0eaa\u0eb9\u0ec9\u0e8a\u0ebb\u0e99"),t.qZA(),t.TgZ(13,"th",24),t._uU(14,"\u0ea7\u0ebd\u0e81\u0ea1\u0ead\u0e9a\u0edd\u0eb2\u0e8d"),t.qZA(),t.TgZ(15,"th",24),t._uU(16,"\u0ea7\u0ebd\u0e81\u0e9e\u0eb2\u0ea5\u0eb0\u0e9a\u0ebb\u0e94\u0e9a\u0eb2\u0e94"),t.qZA(),t.TgZ(17,"th",24),t._uU(18,"\u0e84\u0eb0\u0ec1\u0e99\u0e99\u0e9c\u0ebb\u0e99\u0e87\u0eb2\u0e99"),t.qZA(),t.TgZ(19,"th",24),t._uU(20,"\u0e84\u0eb0\u0ec1\u0e99\u0e99\u0e9e\u0eb6\u0e94\u0e95\u0eb4\u0e81\u0eb3"),t.qZA(),t.TgZ(21,"th",24),t._uU(22,"\u0ea5\u0ea7\u0ea1\u0e84\u0eb0\u0ec1\u0e99\u0e99\u0e97\u0eb1\u0e87\u0edd\u0ebb\u0e94"),t.qZA(),t.TgZ(23,"th",24),t._uU(24,"\u0ec0\u0e81\u0ea3\u0e94 (\u0ea5\u0eb0\u0e9a\u0ebb\u0e9a)"),t.qZA(),t.TgZ(25,"th",24),t._uU(26,"\u0ec0\u0e81\u0ea3\u0e94 (\u0e9e\u0eb0\u0ec1\u0e99\u0e81)"),t.qZA(),t.TgZ(27,"th",24),t._uU(28,"\u0ec0\u0e81\u0ea3\u0e94 (\u0e9d\u0ec8\u0eb2\u0e8d)"),t.qZA(),t.TgZ(29,"th",24),t._uU(30,"\u0e88\u0eb1\u0e94\u0e81\u0eb2\u0e99"),t.qZA()())}function Zt(i,o){if(1&i&&(t.TgZ(0,"span",31),t._uU(1),t.qZA()),2&i){const e=t.oxw().$implicit;t.xp6(1),t.Oqu(null==e?null:e.divisionName)}}function _t(i,o){1&i&&(t.TgZ(0,"span",31),t._uU(1,"\u0e84\u0eb0\u0e99\u0eb0\u0e9d\u0ec8\u0eb2\u0e8d"),t.qZA())}const bt=function(i,o,e){return{A:i,B:o,C:e}},h=function(i){return{"text-red-500":i}};function Dt(i,o){if(1&i&&(t.TgZ(0,"tr",26)(1,"td",27)(2,"div",28),t._UZ(3,"i",29),t.YNc(4,Zt,2,1,"span",30),t.YNc(5,_t,2,0,"span",30),t.qZA()()()),2&i){const e=o.$implicit,u=t.oxw();t.Q6J("ngClass",t.VKq(7,h,u.checkAnyGradeExceedDeptPercent(null==e?null:e.divisionId,t.kEZ(3,bt,u.maxA,u.maxB,u.maxC)))),t.xp6(4),t.Q6J("ngIf",e.divisionId),t.xp6(1),t.Q6J("ngIf",!e.divisionId)}}function Tt(i,o){1&i&&(t.TgZ(0,"span"),t._uU(1,"\u0ec0\u0e81\u0eb5\u0e99\u0ec0\u0e9b\u0ebb\u0ec9\u0eb2"),t.qZA())}function qt(i,o){1&i&&(t.TgZ(0,"span"),t._uU(1,"\u0ec0\u0e81\u0eb5\u0e99\u0ec0\u0e9b\u0ebb\u0ec9\u0eb2"),t.qZA())}function Ut(i,o){1&i&&(t.TgZ(0,"span"),t._uU(1,"\u0ec0\u0e81\u0eb5\u0e99\u0ec0\u0e9b\u0ebb\u0ec9\u0eb2"),t.qZA())}function yt(i,o){if(1&i&&(t.TgZ(0,"tr")(1,"td",32),t._uU(2,"\u0e81\u0eb3\u0e99\u0ebb\u0e94\u0ec0\u0e81\u0e99\u0e84\u0eb0\u0ec1\u0e99\u0e99"),t.qZA(),t.TgZ(3,"td",33),t._UZ(4,"p-chip",34),t.qZA(),t.TgZ(5,"td",33),t._UZ(6,"p-chip",35),t.qZA(),t.TgZ(7,"td",33),t._UZ(8,"p-chip",36),t.qZA(),t.TgZ(9,"td",33),t._UZ(10,"p-chip",37),t.qZA(),t.TgZ(11,"td",33),t._UZ(12,"p-chip",38),t.qZA(),t.TgZ(13,"td",39),t._uU(14,"\u0ea5\u0ea7\u0ea1"),t.qZA()(),t.TgZ(15,"tr")(16,"td",40),t._uU(17,"\u0e88\u0eb3\u0e99\u0ea7\u0e99"),t.qZA(),t.TgZ(18,"td",41),t._uU(19),t.qZA(),t.TgZ(20,"td",41),t._uU(21),t.qZA(),t.TgZ(22,"td",41),t._uU(23),t.qZA(),t.TgZ(24,"td",41),t._uU(25),t.qZA(),t.TgZ(26,"td",41),t._uU(27),t.qZA(),t.TgZ(28,"td",42),t._uU(29),t.qZA()(),t._UZ(30,"tr"),t.TgZ(31,"tr")(32,"td",40),t._uU(33,"\u0eaa\u0eb0\u0ec0\u0ea5\u0ec8\u0e8d (%)"),t.qZA(),t.TgZ(34,"td",43),t._uU(35),t.qZA(),t.TgZ(36,"td",43),t._uU(37),t.qZA(),t.TgZ(38,"td",43),t._uU(39),t.qZA(),t.TgZ(40,"td",44),t._uU(41),t.qZA(),t.TgZ(42,"td",44),t._uU(43),t.qZA(),t.TgZ(44,"td",42),t._uU(45),t.qZA()(),t.TgZ(46,"tr")(47,"td",40),t._uU(48,"\u0e84\u0ea7\u0eb2\u0ea1\u0e94\u0eb8\u0ec8\u0e99\u0e94\u0ebd\u0e87"),t.qZA(),t.TgZ(49,"td",45),t.YNc(50,Tt,2,0,"span",46),t.qZA(),t.TgZ(51,"td",45),t.YNc(52,qt,2,0,"span",46),t.qZA(),t.TgZ(53,"td",45),t.YNc(54,Ut,2,0,"span",46),t.qZA(),t._UZ(55,"td",47),t.qZA()),2&i){const e=o.$implicit,u=t.oxw();t.xp6(4),t.Q6J("styleClass",u.gradeService.getGradeClass("A")+" text-white font-bold px-3"),t.xp6(2),t.Q6J("styleClass",u.gradeService.getGradeClass("B")+" text-white font-bold px-3"),t.xp6(2),t.Q6J("styleClass",u.gradeService.getGradeClass("C")+" text-white font-bold px-3"),t.xp6(2),t.Q6J("styleClass",u.gradeService.getGradeClass("D")+" text-white font-bold px-3"),t.xp6(2),t.Q6J("styleClass",u.gradeService.getGradeClass("F")+" text-white font-bold px-3"),t.xp6(7),t.hij(" ",u.gradeService.sumGradeByDivision(u.items,null==e?null:e.divisionId,"A")," "),t.xp6(2),t.hij(" ",u.gradeService.sumGradeByDivision(u.items,null==e?null:e.divisionId,"B")," "),t.xp6(2),t.hij(" ",u.gradeService.sumGradeByDivision(u.items,null==e?null:e.divisionId,"C")," "),t.xp6(2),t.hij(" ",u.gradeService.sumGradeByDivision(u.items,null==e?null:e.divisionId,"D")," "),t.xp6(2),t.hij(" ",u.gradeService.sumGradeByDivision(u.items,null==e?null:e.divisionId,"F")," "),t.xp6(2),t.hij(" ",u.gradeService.sumTotalGradesByDivision(u.items,null==e?null:e.divisionId)," "),t.xp6(5),t.Q6J("ngClass",u.getGradeAvgClass(null==e?null:e.divisionId,"A",u.maxA)),t.xp6(1),t.hij(" ",(u.gradeService.calcGradeAvgByDiv(u.items,null==e?null:e.divisionId,"A")||0).toFixed(2),"% "),t.xp6(1),t.Q6J("ngClass",u.getGradeAvgClass(null==e?null:e.divisionId,"B",u.maxB)),t.xp6(1),t.hij(" ",(u.gradeService.calcGradeAvgByDiv(u.items,null==e?null:e.divisionId,"B")||0).toFixed(2),"% "),t.xp6(1),t.Q6J("ngClass",u.getGradeAvgClass(null==e?null:e.divisionId,"C",u.maxC)),t.xp6(1),t.hij(" ",(u.gradeService.calcGradeAvgByDiv(u.items,null==e?null:e.divisionId,"C")||0).toFixed(2),"% "),t.xp6(2),t.hij(" ",(u.gradeService.calcGradeAvgByDiv(u.items,null==e?null:e.divisionId,"D")||0).toFixed(2),"% "),t.xp6(2),t.hij(" ",(u.gradeService.calcGradeAvgByDiv(u.items,null==e?null:e.divisionId,"F")||0).toFixed(2),"% "),t.xp6(2),t.hij(" ",u.getTotalPercentByDiv(null==e?null:e.divisionId).toFixed(0),"% "),t.xp6(4),t.Q6J("ngClass",t.VKq(26,h,u.isGradeExceedingDeptPercent(null==e?null:e.divisionId,"A",u.maxA))),t.xp6(1),t.Q6J("ngIf",u.isGradeExceedingDeptPercent(null==e?null:e.divisionId,"A",u.maxA)),t.xp6(1),t.Q6J("ngClass",t.VKq(28,h,u.isGradeExceedingDeptPercent(null==e?null:e.divisionId,"B",u.maxB))),t.xp6(1),t.Q6J("ngIf",u.isGradeExceedingDeptPercent(null==e?null:e.divisionId,"B",u.maxB)),t.xp6(1),t.Q6J("ngClass",t.VKq(30,h,u.isGradeExceedingDeptPercent(null==e?null:e.divisionId,"C",u.maxC))),t.xp6(1),t.Q6J("ngIf",u.isGradeExceedingDeptPercent(null==e?null:e.divisionId,"C",u.maxC))}}const St=function(){return{width:"50px"}};function Gt(i,o){if(1&i&&(t.TgZ(0,"tr")(1,"td",48),t._uU(2),t.qZA(),t.TgZ(3,"td",24),t._uU(4),t.qZA(),t.TgZ(5,"td",25),t._uU(6),t.qZA(),t.TgZ(7,"td",25),t._uU(8),t.qZA(),t.TgZ(9,"td",25),t._uU(10),t.qZA(),t.TgZ(11,"td",24),t._uU(12),t.qZA(),t.TgZ(13,"td",24),t._uU(14),t.qZA(),t.TgZ(15,"td",24),t._uU(16),t.qZA(),t.TgZ(17,"td",49),t._uU(18),t.qZA(),t.TgZ(19,"td",24),t._uU(20),t.qZA(),t.TgZ(21,"td",49),t._uU(22),t.qZA(),t.TgZ(23,"td",24),t._UZ(24,"p-chip",50),t.qZA(),t.TgZ(25,"td",24),t._UZ(26,"p-chip",50),t.qZA(),t.TgZ(27,"td",24),t._UZ(28,"p-chip",50),t.qZA(),t.TgZ(29,"td",24),t._UZ(30,"app-btn-action",51),t.qZA()()),2&i){const e=o.$implicit,u=o.rowIndex,n=t.oxw();t.xp6(1),t.Q6J("ngStyle",t.DdM(19,St)),t.xp6(1),t.hij(" ",u+1," "),t.xp6(2),t.hij(" ",null==e?null:e.staffCode," "),t.xp6(2),t.hij(" ",null==e?null:e.firstName," "),t.xp6(2),t.hij(" ",null==e?null:e.lastName," "),t.xp6(2),t.hij(" ",null==e?null:e.positionName," "),t.xp6(2),t.hij(" ",null==e?null:e.taskPlanScore," "),t.xp6(2),t.hij(" ",null==e?null:e.taskAssignScore," "),t.xp6(2),t.hij(" ",null==e?null:e.taskDescScore," "),t.xp6(2),t.hij(" ",null==e?null:e.taskCalcScore," "),t.xp6(2),t.hij(" ",null==e?null:e.attendScore," "),t.xp6(2),t.hij(" ",null==e?null:e.finalScore," "),t.xp6(2),t.Q6J("label",null==e?null:e.sysGrade)("styleClass",n.gradeService.getGradeClass(e.sysGrade)+" text-white font-bold px-3"),t.xp6(2),t.Q6J("label",null==e?null:e.divGrade)("styleClass",n.gradeService.getGradeClass(e.divGrade)+" text-white font-bold px-3"),t.xp6(2),t.Q6J("label",null==e?null:e.deptGrade)("styleClass",n.gradeService.getGradeClass(null==e?null:e.deptGrade)+" text-white font-bold px-3"),t.xp6(2),t.Q6J("item",e)}}function It(i,o){1&i&&(t.TgZ(0,"span"),t._uU(1,"\u0ec0\u0e81\u0eb5\u0e99\u0ec0\u0e9b\u0ebb\u0ec9\u0eb2"),t.qZA())}function Jt(i,o){1&i&&(t.TgZ(0,"span"),t._uU(1,"\u0ec0\u0e81\u0eb5\u0e99\u0ec0\u0e9b\u0ebb\u0ec9\u0eb2"),t.qZA())}function wt(i,o){1&i&&(t.TgZ(0,"span"),t._uU(1,"\u0ec0\u0e81\u0eb5\u0e99\u0ec0\u0e9b\u0ebb\u0ec9\u0eb2"),t.qZA())}function Qt(i,o){if(1&i){const e=t.EpF();t.TgZ(0,"p-button",61),t.NdJ("onClick",function(){t.CHM(e);const n=t.oxw(3);return t.KtG(n.onApprove())}),t.qZA()}if(2&i){const e=t.oxw(3);t.Q6J("disabled",e.isApprovalDisabled)}}function Nt(i,o){1&i&&(t.TgZ(0,"div",62),t._uU(1," \u0e9a\u0ecd\u0ec8\u0ea2\u0eb9\u0ec8\u0ec3\u0e99\u0ec0\u0e87\u0eb7\u0ec8\u0ead\u0e99\u0ec4\u0e82\u0e97\u0eb5\u0ec8\u0eaa\u0eb2\u0ea1\u0eb2\u0e94\u0ead\u0eb0\u0e99\u0eb8\u0ea1\u0eb1\u0e94\u0ec4\u0e94\u0ec9! "),t.qZA())}function Yt(i,o){1&i&&(t.TgZ(0,"p-tag",63)(1,"div",64),t._UZ(2,"i",65),t.TgZ(3,"span",66),t._uU(4,"\u0ead\u0eb0\u0e99\u0eb8\u0ea1\u0eb1\u0e94\u0ec1\u0ea5\u0ec9\u0ea7"),t.qZA()()()),2&i&&t.Q6J("rounded",!0)}function Ft(i,o){if(1&i&&(t.ynx(0),t.TgZ(1,"div",52)(2,"table",53)(3,"tr")(4,"td"),t._uU(5,"\u0e81\u0eb3\u0e99\u0ebb\u0e94\u0ec0\u0e81\u0e99\u0e84\u0eb0\u0ec1\u0e99\u0e99"),t.qZA(),t.TgZ(6,"td",54),t._UZ(7,"p-chip",34),t.qZA(),t.TgZ(8,"td",54),t._UZ(9,"p-chip",35),t.qZA(),t.TgZ(10,"td",54),t._UZ(11,"p-chip",36),t.qZA(),t.TgZ(12,"td",54),t._UZ(13,"p-chip",37),t.qZA(),t.TgZ(14,"td",54),t._UZ(15,"p-chip",38),t.qZA(),t.TgZ(16,"td",23),t._uU(17,"\u0ea5\u0ea7\u0ea1"),t.qZA()(),t.TgZ(18,"tr")(19,"td"),t._uU(20,"\u0e88\u0eb3\u0e99\u0ea7\u0e99"),t.qZA(),t.TgZ(21,"td",23),t._uU(22),t.qZA(),t.TgZ(23,"td",23),t._uU(24),t.qZA(),t.TgZ(25,"td",23),t._uU(26),t.qZA(),t.TgZ(27,"td",23),t._uU(28),t.qZA(),t.TgZ(29,"td",23),t._uU(30),t.qZA(),t.TgZ(31,"td",23),t._uU(32),t.qZA()(),t.TgZ(33,"tr")(34,"td"),t._uU(35,"\u0eaa\u0eb0\u0ec0\u0ea5\u0ec8\u0e8d (%)"),t.qZA(),t.TgZ(36,"td",55),t._uU(37),t.qZA(),t.TgZ(38,"td",55),t._uU(39),t.qZA(),t.TgZ(40,"td",55),t._uU(41),t.qZA(),t.TgZ(42,"td",56),t._uU(43),t.qZA(),t.TgZ(44,"td",56),t._uU(45),t.qZA(),t.TgZ(46,"td",23),t._uU(47),t.qZA()(),t.TgZ(48,"tr")(49,"td"),t._uU(50,"\u0e84\u0ea7\u0eb2\u0ea1\u0e94\u0eb8\u0ec8\u0e99\u0e94\u0ebd\u0e87"),t.qZA(),t.TgZ(51,"td",45),t.YNc(52,It,2,0,"span",46),t.qZA(),t.TgZ(53,"td",45),t.YNc(54,Jt,2,0,"span",46),t.qZA(),t.TgZ(55,"td",45),t.YNc(56,wt,2,0,"span",46),t.qZA(),t._UZ(57,"td",47),t.qZA()()(),t.TgZ(58,"div",57),t.YNc(59,Qt,1,1,"p-button",58),t.YNc(60,Nt,2,0,"div",59),t.YNc(61,Yt,5,1,"p-tag",60),t.qZA(),t.BQk()),2&i){const e=t.oxw(2);t.xp6(7),t.Q6J("styleClass",e.gradeService.getGradeClass("A")+" text-white font-bold px-3"),t.xp6(2),t.Q6J("styleClass",e.gradeService.getGradeClass("B")+" text-white font-bold px-3"),t.xp6(2),t.Q6J("styleClass",e.gradeService.getGradeClass("C")+" text-white font-bold px-3"),t.xp6(2),t.Q6J("styleClass",e.gradeService.getGradeClass("D")+" text-white font-bold px-3"),t.xp6(2),t.Q6J("styleClass",e.gradeService.getGradeClass("F")+" text-white font-bold px-3"),t.xp6(7),t.Oqu(e.quotaA),t.xp6(2),t.Oqu(e.quotaB),t.xp6(2),t.Oqu(e.quotaC),t.xp6(2),t.Oqu(e.quotaD),t.xp6(2),t.Oqu(e.quotaF),t.xp6(2),t.Oqu(e.totalQuotas),t.xp6(4),t.Q6J("ngClass",e.percentA>e.maxA?"bg-red-600":"bg-green-600"),t.xp6(1),t.hij(" ",e.percentA.toFixed(2),"% "),t.xp6(1),t.Q6J("ngClass",e.isABGreaterThanMaxAB()?"bg-red-600":"bg-green-600"),t.xp6(1),t.hij(" ",e.percentB.toFixed(2),"% "),t.xp6(1),t.Q6J("ngClass",e.isABCGreaterThanMaxABC()?"bg-red-600":"bg-green-600"),t.xp6(1),t.hij(" ",e.percentC.toFixed(2),"% "),t.xp6(2),t.hij(" ",e.percentD.toFixed(2),"% "),t.xp6(2),t.hij(" ",e.percentF.toFixed(2),"% "),t.xp6(2),t.hij(" ",e.totalPercent.toFixed(0),"% "),t.xp6(4),t.Q6J("ngClass",t.VKq(29,h,e.percentA>e.maxA)),t.xp6(1),t.Q6J("ngIf",e.percentA>e.maxA),t.xp6(1),t.Q6J("ngClass",t.VKq(31,h,e.isABGreaterThanMaxAB())),t.xp6(1),t.Q6J("ngIf",e.isABGreaterThanMaxAB()),t.xp6(1),t.Q6J("ngClass",t.VKq(33,h,e.isABCGreaterThanMaxABC())),t.xp6(1),t.Q6J("ngIf",e.isABCGreaterThanMaxABC()),t.xp6(3),t.Q6J("ngIf",!e.isConfirmed),t.xp6(1),t.Q6J("ngIf",e.isApprovalDisabled),t.xp6(1),t.Q6J("ngIf",e.isConfirmed)}}function jt(i,o){if(1&i&&t.YNc(0,Ft,62,35,"ng-container",46),2&i){const e=t.oxw();t.Q6J("ngIf",e.items&&(null==e.items?null:e.items.length))}}function Kt(i,o){1&i&&(t.TgZ(0,"tr")(1,"td",67),t._uU(2,"\u0e9a\u0ecd\u0ec8\u0e9e\u0ebb\u0e9a\u0e82\u0ecd\u0ec9\u0ea1\u0eb9\u0e99"),t.qZA()())}const Mt=function(){return{"min-width":"250px"}},kt=[{path:"",component:(()=>{class i{constructor(e,u,n,a,l,d,g,m,D,zt,Lt,Vt,Xt){this.menuService=e,this.utilService=u,this.filter=n,this.gradeService=a,this.dialogRef=l,this.loadingService=d,this.divisionService=g,this.cdr=m,this.apprService=D,this.fb=zt,this.userService=Lt,this.alertService=Vt,this.dialogService=Xt,this.items=[],this.filteredItems=[],this.isConfirmed=!1,this.divisions=[],this.totalDeptStaff=0,this.totalPercent=0,this.maxA=T.c.MAXA,this.maxB=T.c.MAXB,this.maxC=T.c.MAXC,this.percentA=0,this.percentB=0,this.percentC=0,this.percentD=0,this.percentF=0,this.quotaA=0,this.quotaB=0,this.quotaC=0,this.quotaD=0,this.quotaF=0,this.screenHeight=0,this.filterFields=["staffCode","firstName","lastName","positionName"],this.loading$=this.loadingService.state$,this.destroy$=new Y.x}ngOnInit(){this.formGroup=this.fb.formGroup(new H.L),this.formGroup.get("batchCode")?.valueChanges.subscribe(e=>this.parentSelected=e),this.initUserDetails(),this.subscribeToData(),this.getDivisions(),this.checkScreenSize()}get isApprovalDisabled(){if(!this.selectedMonth)return!0;let e=[this.percentA,this.percentB,this.percentC],u=[this.maxA,this.maxB,this.maxC];for(let n=0;n<e.length;n++)if(e.slice(0,n+1).reduce((a,l)=>a+l,0)>u.slice(0,n+1).reduce((a,l)=>a+l,0))return!0;return!1}get totalQuotas(){return this.quotaA+this.quotaB+this.quotaC+this.quotaD+this.quotaF}getDivisions(){if(this.batchCode&&this.deptId){const e=Object.assign({departmentId:this.deptId});this.divisionService.getAll(e).subscribe()}else this.divisions=[]}onChangeDivision(e){this.filteredItems=e?this.items.filter(u=>u.divisionId===e):[...this.items]}onSelectMonth(e){this.formGroup.patchValue({divisionId:null}),this.selectedMonth=e,this.selectedMonth&&(this.prepareBatchCode(),this.countDeptEvalStaff(),this.getReport(),this.checkConfirmation())}getReport(){if(this.batchCode){const u=q.getMany({batchCode:this.batchCode,departmentId:this.deptId});this.apprService.getMany(u).subscribe({error:n=>this.alertService.showError(n)})}}getTotalPercentByDiv(e){return this.gradeService.calcTotalGradePercentByDiv(this.items,e)}getGradeAvgClass(e,u,n){const a=this.gradeService.calcGradeAvgByDiv(this.items,e,u)||0;return{"font-bold":a>n,"text-red-500":a>n,"font-semibold":a<=n}}isGradeExceedingDeptPercent(e,u,n){return(this.gradeService.calcGradeAvgByDiv(this.items,e,u)||0)>n}checkAnyGradeExceedDeptPercent(e,u){return["A","B","C"].some(a=>this.isGradeExceedingDeptPercent(e,a,u[a]))}isABGreaterThanMaxAB(){return this.percentA+this.percentB>this.maxA+this.maxB}isABCGreaterThanMaxABC(){return this.percentA+this.percentB+this.percentC>this.maxA+this.maxB+this.maxC}initUserDetails(){this.user=this.userService.getLoggedUser(),this.userRoleId=this.user?.role?.id??0,this.deptId=this.user?.profile?.department?.id??0,this.divId=this.user?.profile?.division?.id??0}subscribeToData(){this.apprService.items$.pipe((0,F.R)(this.destroy$)).subscribe(e=>{this.items=e,this.filteredItems=e,this.processKpiScoreReports(e),this.cdr.markForCheck()}),this.divisionService.items$.pipe((0,F.R)(this.destroy$)).subscribe(e=>{this.divisions=e,this.cdr.markForCheck()})}processKpiScoreReports(e){const u=e.filter(n=>parseFloat(n.taskCalcScore)>0);this.resetQuotas(),u?.forEach(n=>{this.sumDeptQuota(n.deptGrade??n.divGrade??n.sysGrade)}),this.updatePercentages()}resetQuotas(){this.quotaA=this.quotaB=this.quotaC=this.quotaD=this.quotaF=0}sumDeptQuota(e){switch(e){case"A":this.quotaA++;break;case"B":this.quotaB++;break;case"C":this.quotaC++;break;case"D":this.quotaD++;break;case"F":this.quotaF++}}prepareBatchCode(){const e=this.selectedMonth.getFullYear(),u=this.selectedMonth.getMonth()+1;this.batchCode=`${e}${u.toString().padStart(2,"0")}`}countDeptEvalStaff(){this.apprService.countEvalStaff({batchCode:this.batchCode,departmentId:this.deptId,isActive:!0}).subscribe({next:u=>{u&&(this.totalDeptStaff=u,this.updatePercentages())},error:u=>this.alertService.showDanger(u)})}updatePercentages(){this.totalDeptStaff>0&&(this.percentA=this.quotaA/this.totalDeptStaff*100,this.percentB=this.quotaB/this.totalDeptStaff*100,this.percentC=this.quotaC/this.totalDeptStaff*100,this.percentD=this.quotaD/this.totalDeptStaff*100,this.percentF=this.quotaF/this.totalDeptStaff*100,this.totalPercent=this.percentA+this.percentB+this.percentC+this.percentD+this.percentF)}checkConfirmation(){this.apprService.checkConfirmStatus({batchCode:this.batchCode,departmentId:this.deptId,isApproved:!0}).subscribe(u=>{this.isConfirmed=u})}onApprove(){this.dialogRef=this.dialogService.open(V,{header:"\u0ea2\u0eb7\u0e99\u0ea2\u0eb1\u0e99\u0e81\u0eb2\u0e99\u0ead\u0eb0\u0e99\u0eb8\u0ea1\u0eb1\u0e94",width:"50%",data:{data:{batchCode:this.batchCode,departmentId:this.deptId}},contentStyle:{overflow:"auto","padding-bottom":"20px"},baseZIndex:1e4,dismissableMask:!1})}onResize(e){this.checkScreenSize()}checkScreenSize(){this.screenHeight=Math.floor(.6*window.innerHeight),this.cdr.detectChanges()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete(),this.dialogRef?.close()}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(X.h),t.Y36(W.F),t.Y36(tt.i),t.Y36(G.U),t.Y36(c.E7),t.Y36(et.b),t.Y36(ut.E),t.Y36(t.sBO),t.Y36(Z),t.Y36(p.GW),t.Y36(I.K),t.Y36(U.c),t.Y36(c.xA))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-kpi-dept-appr"]],hostBindings:function(e,u){1&e&&t.NdJ("resize",function(a){return u.onResize(a)},!1,t.Jf7)},decls:29,vars:21,consts:[[1,"p-grid","mt-4"],[1,"p-col-12"],[1,"flex","align-items-center","justify-content-between"],[1,"flex","align-items-center"],[1,"text-2xl","font-semibold","ml-2"],[1,"mr-2"],[3,"formGroup"],["for","monthPicker",1,"mr-2","font-semibold","text-lg"],["view","month","dateFormat","mm/yy","inputId","monthPicker","placeholder","\u0ec0\u0ea5\u0eb7\u0ead\u0e81\u0e9b\u0eb5/\u0ec0\u0e94\u0eb7\u0ead\u0e99","formControlName","batchCode","styleClass","mr-2",3,"readonlyInput","onSelect"],["appendTo","body","id","divisionId","optionValue","id","optionLabel","name","emptyFilterMessage","\u0e9a\u0ecd\u0ec8\u0e9e\u0ebb\u0e9a\u0e82\u0ecd\u0ec9\u0ea1\u0eb9\u0e99","placeholder","\u0e9e\u0eb0\u0ec1\u0e99\u0e81\u0e97\u0eb1\u0e87\u0edd\u0ebb\u0e94",1,"mr-2",3,"options","filter","resetFilterOnHide","showClear","emptyMessage","onChange","onClear","onFocus"],["pTemplate","selectedItem"],["pTemplate","item"],[1,"p-input-icon-left"],[1,"pi","pi-search"],["pInputText","","type","text","placeholder","\u0e84\u0ebb\u0ec9\u0e99\u0eab\u0eb2..",3,"input"],["rowGroupMode","subheader","groupRowsBy","divisionId","responsiveLayout","scroll","styleClass","p-datatable-sm",3,"value","rowHover","globalFilterFields","scrollable","scrollHeight"],["dt",""],["pTemplate","header"],["pTemplate","groupheader"],["pTemplate","groupfooter"],["pTemplate","body"],["pTemplate","summary"],["pTemplate","emptymessage"],[1,"text-center"],[1,"white-space-nowrap","text-center"],[1,"white-space-nowrap"],["pRowGroupHeader","",3,"ngClass"],["colspan","15"],[1,"text-groupheader","text-2xl"],[1,"pi","pi-th-large","mr-2"],["class","font-semibold",4,"ngIf"],[1,"font-semibold"],["colspan","9",1,"white-space-nowrap","font-bold","text-lg","text-right","pt-4"],[1,"text-center","white-space-nowrap","pt-4"],["label","A (5%)",3,"styleClass"],["label","B (30%)",3,"styleClass"],["label","C (50%)",3,"styleClass"],["label","D (\u0e9a\u0ecd\u0ec8\u0e88\u0eb3\u0e81\u0eb1\u0e94)",3,"styleClass"],["label","F (\u0e9a\u0ecd\u0ec8\u0e88\u0eb3\u0e81\u0eb1\u0e94)",3,"styleClass"],[1,"text-center","font-bold","pt-4"],["colspan","9",1,"white-space-nowrap","font-bold","text-lg","text-right"],[1,"text-center","text-lg","font-semibold"],[1,"text-center","text-lg","font-bold"],[1,"text-center",3,"ngClass"],[1,"text-center","font-semibold"],[1,"text-center","font-semibold",3,"ngClass"],[4,"ngIf"],["colspan","3"],[1,"text-center",3,"ngStyle"],[1,"white-space-nowrap","text-center","font-bold"],[3,"label","styleClass"],[3,"item"],[1,"px-8","pt-6","font-bold","text-xl"],[1,"table-custom","card"],[1,"text-center","white-space-nowrap"],[1,"text-center","text-white",3,"ngClass"],[1,"bg-green-600","text-center","text-white"],[1,"text-center","mt-7","mb-6"],["label","\u0ead\u0eb0\u0e99\u0eb8\u0ea1\u0eb1\u0e94\u0e9c\u0ebb\u0e99\u0e84\u0eb0\u0ec1\u0e99\u0e99","styleClass","p-button-rounded text-xl font-bold px-6",3,"disabled","onClick",4,"ngIf"],["class","text-red-500 text-lg mt-4",4,"ngIf"],["severity","success","styleClass","text-xl px-6 py-2",3,"rounded",4,"ngIf"],["label","\u0ead\u0eb0\u0e99\u0eb8\u0ea1\u0eb1\u0e94\u0e9c\u0ebb\u0e99\u0e84\u0eb0\u0ec1\u0e99\u0e99","styleClass","p-button-rounded text-xl font-bold px-6",3,"disabled","onClick"],[1,"text-red-500","text-lg","mt-4"],["severity","success","styleClass","text-xl px-6 py-2",3,"rounded"],[1,"flex","align-items-center","gap-2"],[1,"pi","pi-check-circle"],[1,"text-xl"],["colspan","15",1,"text-center","py-4"]],template:function(e,u){if(1&e){const n=t.EpF();t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"span",4),t._uU(5),t.ALo(6,"number"),t.qZA()(),t.TgZ(7,"div",3)(8,"div",5)(9,"form",6)(10,"label",7),t._uU(11,"\u0e9b\u0eb0\u0e88\u0eb3\u0ec0\u0e94\u0eb7\u0ead\u0e99:"),t.qZA(),t.TgZ(12,"p-calendar",8),t.NdJ("onSelect",function(l){return u.onSelectMonth(l)}),t.qZA(),t.TgZ(13,"p-dropdown",9),t.NdJ("onChange",function(l){return u.onChangeDivision(l.value)})("onClear",function(){return u.getReport()})("onFocus",function(){return u.getDivisions()}),t.ALo(14,"async"),t.YNc(15,Bt,3,2,"ng-template",10),t.YNc(16,xt,2,2,"ng-template",11),t.qZA(),t.TgZ(17,"span",12),t._UZ(18,"i",13),t.TgZ(19,"input",14),t.NdJ("input",function(l){t.CHM(n);const d=t.MAs(22);return t.KtG(u.filter.dataTable(d,l))}),t.qZA()()()()()(),t._UZ(20,"hr"),t.TgZ(21,"p-table",15,16),t.YNc(23,vt,31,0,"ng-template",17),t.YNc(24,Dt,6,9,"ng-template",18),t.YNc(25,yt,56,32,"ng-template",19),t.YNc(26,Gt,31,20,"ng-template",20),t.YNc(27,jt,1,1,"ng-template",21),t.YNc(28,Kt,3,0,"ng-template",22),t.qZA()()()}2&e&&(t.xp6(5),t.hij(" \u0eaa\u0eb0\u0ea1\u0eb2\u0e8a\u0eb4\u0e81\u0e97\u0eb5\u0ec8\u0ea1\u0eb5\u0e81\u0eb2\u0e99\u0e9b\u0eb0\u0ec0\u0ea1\u0eb5\u0e99\u0e97\u0eb1\u0e87\u0edd\u0ebb\u0e94\u0e9d\u0ec8\u0eb2\u0e8d (",t.xi3(6,15,u.totalDeptStaff,"1.0-0"),") \u0e97\u0ec8\u0eb2\u0e99 "),t.xp6(4),t.Q6J("formGroup",u.formGroup),t.xp6(3),t.Q6J("readonlyInput",!0),t.xp6(1),t.Akn(t.DdM(20,Mt)),t.Q6J("options",u.divisions)("filter",!0)("resetFilterOnHide",!0)("showClear",!0)("emptyMessage",t.lcZ(14,18,u.loading$)?"\u0e81\u0eb3\u0ea5\u0eb1\u0e87\u0ec2\u0eab\u0ebc\u0e94..":u.parentSelected?"\u0e9a\u0ecd\u0ec8\u0e9e\u0ebb\u0e9a\u0e82\u0ecd\u0ec9\u0ea1\u0eb9\u0e99":"\u0e81\u0eb0\u0ea5\u0eb8\u0e99\u0eb2\u0ec0\u0ea5\u0eb7\u0ead\u0e81\u0e9b\u0eb5/\u0ec0\u0e94\u0eb7\u0ead\u0e99"),t.xp6(8),t.Q6J("value",u.filteredItems)("rowHover",!0)("globalFilterFields",u.filterFields)("scrollable",!0)("scrollHeight",u.screenHeight+"px"))},dependencies:[E.mk,E.O5,E.PC,r._Y,r.JJ,r.JL,r.sg,r.u,p.bc,p.VP,p.YE,M.f,B.zx,_.jx,J.iA,J.Z5,k.o,O.V,$.Lt,b.A,ft,E.Ov,E.JJ],encapsulation:2,changeDetection:0}),i})()}];let Ot=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[N.Bz.forChild(kt),N.Bz]}),i})();var $t=s(4466),Rt=s(3608),Pt=s(2825);let Ht=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[E.ez,Ot,$t.m,M._8,J.U$,w.L,k.j,P.l,O.W,B.hJ,Rt.z,$.kW,b.o,S.A,Pt.$]}),i})()}}]);