"use strict";(self.webpackChunkavalon_ng=self.webpackChunkavalon_ng||[]).push([[6620],{3609:(b,x,a)=>{a.d(x,{Q:()=>M});var n=a(8274),F=a(1481),e=a(1094),u=a(6895),C=a(5593),s=a(3930);function h(d,v){if(1&d&&(n.ynx(0),n._UZ(1,"img",6),n.BQk()),2&d){const c=n.oxw(2);n.xp6(1),n.Q6J("src",c.safeUrl,n.LSH)}}function P(d,v){if(1&d){const c=n.EpF();n.TgZ(0,"p-button",7),n.NdJ("click",function(g){n.CHM(c);const w=n.oxw(2);return n.KtG(w.onClosePreview(g))}),n.qZA(),n._UZ(1,"ngx-extended-pdf-viewer",8)}if(2&d){const c=n.oxw(2);n.xp6(1),n.Q6J("src",c.selectedFileOrUrl)("useBrowserLocale",!0)}}function y(d,v){if(1&d&&(n.ynx(0),n.YNc(1,h,2,1,"ng-container",3),n.YNc(2,P,2,2,"ng-template",null,5,n.W1O),n.BQk()),2&d){const c=n.MAs(3),m=n.oxw();n.xp6(1),n.Q6J("ngIf",m.isImage)("ngIfElse",c)}}function T(d,v){if(1&d){const c=n.EpF();n.TgZ(0,"p-button",7),n.NdJ("click",function(g){n.CHM(c);const w=n.oxw();return n.KtG(w.onClosePreview(g))}),n.qZA(),n.TgZ(1,"p",9),n._uU(2,"Content not available"),n.qZA()}}const O=function(d){return{"w-full h-full":d}};let M=(()=>{class d{constructor(c,m){this.sanitizer=c,this.utilService=m,this.closePreview=new n.vpe,this.visible=!1,this.isImage=!1}ngOnInit(){this.processFileOrUrl()}processFileOrUrl(){"string"==typeof this.selectedFileOrUrl?this.handleUrl(this.selectedFileOrUrl):this.handleFile(this.selectedFileOrUrl)}handleUrl(c){this.isImage=!c.toLowerCase().endsWith(".pdf"),this.safeUrl=this.sanitizer.bypassSecurityTrustResourceUrl(c)}handleFile(c){this.isImage=c.type.startsWith("image/"),this.safeUrl=this.sanitizer.bypassSecurityTrustResourceUrl(URL.createObjectURL(c))}showImagePreview(){this.visible=!0}onClosePreview(c){c&&c.stopPropagation(),this.closePreview.emit()}}return d.\u0275fac=function(c){return new(c||d)(n.Y36(F.H7),n.Y36(e.F))},d.\u0275cmp=n.Xpm({type:d,selectors:[["app-file-preview"]],inputs:{selectedFileOrUrl:"selectedFileOrUrl"},outputs:{closePreview:"closePreview"},decls:6,vars:5,consts:[[1,"img-preview-overlay"],["icon","pi pi-times","styleClass","p-button-rounded p-button-outlined text-white",1,"img-preview-close",3,"click"],[1,"img-preview-content",3,"ngClass"],[4,"ngIf","ngIfElse"],["errorMessage",""],["pdfContent",""],["crossorigin","anonymous","alt","Image Preview","width","100%","height","100%",1,"border-round",3,"src"],["icon","pi pi-times","styleClass","p-button-rounded p-button-outlined text-right",3,"click"],[3,"src","useBrowserLocale"],[1,"mt-5"]],template:function(c,m){if(1&c&&(n.TgZ(0,"div",0)(1,"p-button",1),n.NdJ("click",function(w){return m.onClosePreview(w)}),n.qZA(),n.TgZ(2,"div",2),n.YNc(3,y,4,2,"ng-container",3),n.YNc(4,T,3,0,"ng-template",null,4,n.W1O),n.qZA()()),2&c){const g=n.MAs(5);n.xp6(2),n.Q6J("ngClass",n.VKq(3,O,!m.isImage)),n.xp6(1),n.Q6J("ngIf",m.safeUrl)("ngIfElse",g)}},dependencies:[u.mk,u.O5,C.zx,s.S3],styles:[".img-preview-overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#000000b3;display:flex;justify-content:center;align-items:center;z-index:9999;cursor:pointer;overflow:auto}.img-preview-content[_ngcontent-%COMP%]{max-width:90vw;max-height:90vh;overflow:hidden;position:relative;background-color:#fff;border-radius:4px;padding:10px;box-shadow:0 0 10px #0000004d}.img-preview-content[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:100%;max-height:100%;object-fit:contain;display:block;margin:0 auto}.img-preview-close[_ngcontent-%COMP%]{position:absolute;top:10px;right:10px;color:#ff5733!important;cursor:pointer}"]}),d})()},6620:(b,x,a)=>{a.d(x,{u:()=>S});var n=a(2156),F=a(209),e=a(8274),u=a(433),C=a(841),s=a(5861),h=a(4004),P=a(2340),y=a(529);let T=(()=>{class i{constructor(t){this.http=t,this.apiUrl=P.N.apiUrl}create(t,o){return this.http.post(`${this.apiUrl}/v1/${o}`,t).pipe((0,h.U)(r=>{if(200===r?.statusCode&&r?.data)return r?.data}))}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(y.eN))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var O=a(704);let M=(()=>{class i{constructor(t,o,l){this.http=t,this.attachService=o,this.alertService=l,this.apiUrl=P.N.apiUrl}readAsDataURL(t){return new Promise((o,l)=>{const r=new FileReader;r.onload=()=>{o(r.result)},r.onerror=p=>{l(p)},r.readAsDataURL(t)})}fileToBase64(t){var o=this;return(0,s.Z)(function*(){const r=yield(yield fetch(t)).blob();return o.readAsDataURL(r)})()}uploadOne(t){return this.http.post(`${this.apiUrl}/v1/upload/one`,t).pipe((0,h.U)(l=>{const r=l.statusCode;if((200===r||201===r)&&l.data)return l.data}))}uploadMany(t){return this.http.post(`${this.apiUrl}/v1/upload/many`,t).pipe((0,h.U)(l=>{const r=l?.statusCode;if((200===r||201===r)&&l?.data)return l.data}))}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(y.eN),e.LFG(T),e.LFG(O.c))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),d=(()=>{class i{constructor(t,o,l){this.uploadService=t,this.alertService=o,this.attachService=l}checkFileUpload(t,o,l,r,p){if(t&&t.length&&o&&l){const f=new FormData,I=t.length;f.append("path",`${l}/${o}`);for(let U=0;U<I;U++)f.append("file",t[U]);this.execUploadFile(o,l,f,r,p)}}execUploadFile(t,o,l,r,p){r&&p&&this.uploadService.uploadMany(l).subscribe({next:f=>{if(f&&f.length){const I=f.map(U=>({attachRefId:p,docRefId:t,fileName:U?.filename,filePath:`${o}/${t}/${U?.filename}`}));this.attachService.create(I,r).subscribe()}},error:f=>{this.alertService.showError(f)}})}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(M),e.LFG(O.c),e.LFG(T))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var v=a(6895),c=a(7147),m=a(3609);function g(i,_){if(1&i){const t=e.EpF();e.ynx(0),e.TgZ(1,"p-chip",6),e.NdJ("click",function(){const r=e.CHM(t).$implicit,p=e.oxw(2);return e.KtG(p.showPreviewFromFile(r))})("onRemove",function(){const r=e.CHM(t).index,p=e.oxw(2);return e.KtG(p.onRemoveNewFile(r))}),e._UZ(2,"i",7),e.TgZ(3,"span",8),e._uU(4),e.qZA()(),e.BQk()}if(2&i){const t=_.$implicit;e.xp6(1),e.Q6J("removable",!0),e.xp6(3),e.hij("",null==t?null:t.name," ")}}function w(i,_){if(1&i&&(e.ynx(0),e.YNc(1,g,5,2,"ng-container",5),e.BQk()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",t.newFiles)}}function E(i,_){if(1&i){const t=e.EpF();e.ynx(0),e.TgZ(1,"p-chip",9),e.NdJ("click",function(){const r=e.CHM(t).$implicit,p=e.oxw(2);return e.KtG(p.showPreviewFromUrl(null==r?null:r.filePath))})("onRemove",function(){const r=e.CHM(t).index,p=e.oxw(2);return e.KtG(p.onRemoveOldFile(r))}),e._UZ(2,"i",7),e.TgZ(3,"span",8),e._uU(4),e.qZA()(),e.BQk()}if(2&i){const t=_.$implicit;e.xp6(4),e.hij(" ",null==t?null:t.fileName," ")}}function H(i,_){if(1&i&&(e.ynx(0),e.YNc(1,E,5,1,"ng-container",5),e.BQk()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",t.oldFiles)}}function R(i,_){if(1&i){const t=e.EpF();e.ynx(0),e.TgZ(1,"app-file-preview",10),e.NdJ("closePreview",function(){e.CHM(t);const l=e.oxw();return e.KtG(l.closeImgPreview())}),e.qZA(),e.BQk()}if(2&i){const t=e.oxw();e.xp6(1),e.Q6J("selectedFileOrUrl",t.selectedFile)}}let S=(()=>{class i{constructor(t,o,l){this.rootFormGroup=t,this.formService=o,this.uploadHelperService=l,this.newFiles=[],this.visiblePreview=!1,n.jc.set(this.formService.validationMessages)}ngOnInit(){this.formGroup=this.rootFormGroup.control}onUpload(t){const o=t?.length;if(o){const l=Math.min(o,F.G.LIMIT-this.newFiles.length);for(let r=0;r<l;r++){const p=t.item(r);p instanceof File&&this.newFiles.push(p)}}}showPreviewFromFile(t){this.selectedFile=t,this.fileSrc=URL.createObjectURL(t),this.visiblePreview=!0}showPreviewFromUrl(t){this.fileSrc=t,this.visiblePreview=!0}closeImgPreview(){this.visiblePreview=!1}onRemoveNewFile(t){this.visiblePreview=!1,this.newFiles.splice(t,1)}onRemoveOldFile(t){}onCheckFileUpload(t,o){this.uploadHelperService.checkFileUpload(this.newFiles,t,o,this.apiPath,this.attachRefId)}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(u.sg),e.Y36(C.k),e.Y36(d))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-upload-helper"]],inputs:{apiPath:"apiPath",attachRefId:"attachRefId",oldFiles:"oldFiles"},decls:7,vars:4,consts:[[1,"flex","gap-2","align-items-center","h-3rem","p-1","border-1","border-dashed","border-gray-500"],[1,"hidden"],["id","files-input","type","file","multiple","",1,"absolute","invisible","w-0","h-0","opacity-0","pointer-events-none",3,"accept","change"],["fileInput",""],[4,"ngIf"],[4,"ngFor","ngForOf"],["styleClass","cursor-pointer",3,"removable","click","onRemove"],[1,"pi","pi-paperclip","mr-2","text-green-500"],[1,"w-8rem","white-space-nowrap","overflow-hidden","text-overflow-ellipsis"],["styleClass","cursor-pointer",3,"click","onRemove"],[3,"selectedFileOrUrl","closePreview"]],template:function(t,o){if(1&t){const l=e.EpF();e.TgZ(0,"div",0)(1,"div",1)(2,"input",2,3),e.NdJ("change",function(){e.CHM(l);const p=e.MAs(3);return e.KtG(o.onUpload(p.files))}),e.qZA()(),e.YNc(4,w,2,1,"ng-container",4),e.YNc(5,H,2,1,"ng-container",4),e.YNc(6,R,2,1,"ng-container",4),e.qZA()}2&t&&(e.xp6(2),e.Q6J("accept","image/jpeg, image/png, image/webp, application/pdf"),e.xp6(2),e.Q6J("ngIf",o.newFiles&&(null==o.newFiles?null:o.newFiles.length)),e.xp6(1),e.Q6J("ngIf",o.oldFiles&&(null==o.oldFiles?null:o.oldFiles.length)),e.xp6(1),e.Q6J("ngIf",o.visiblePreview))},dependencies:[v.sg,v.O5,c.A,m.Q],encapsulation:2}),i})()},1094:(b,x,a)=>{a.d(x,{F:()=>e});var n=a(8274),F=a(6895);let e=(()=>{class u{constructor(s,h){this.datePipe=s,this.decimalPipe=h}dateFormat(s){return s&&this.datePipe.transform(s,"dd/MM/yyyy")||""}dateTimeShortFormat(s){return s&&this.datePipe.transform(s,"dd/MM/yyyy HH:mm")||""}dateTimeLongFormat(s){return s&&this.datePipe.transform(s,"dd/MM/yyyy HH:mm:ss")||""}formatNumber(s){return this.decimalPipe.transform(s,"1.2-2")||""}isValidUrl(s){return/^(http|https):\/\/([a-zA-Z0-9.-]+)(:[0-9]+)?(\/[a-zA-Z0-9-._~:?#[\]@!$&'()*+,;=\/]*)*$/.test(s)}getFullName(s){return`${s?.firstName} ${s?.lastName}`}getTooltip(s,h){return s&&s.length>h?s:""}}return u.\u0275fac=function(s){return new(s||u)(n.LFG(F.uU),n.LFG(F.JJ))},u.\u0275prov=n.Yz7({token:u,factory:u.\u0275fac,providedIn:"root"}),u})()}}]);